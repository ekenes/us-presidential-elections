const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/knowledgeGraphService-jud1FaJD.js","assets/index-GOO0DjDp.js","assets/index-D7_X1F0b.css","assets/Relationship-CdQdDK5m.js"])))=>i.map(i=>d[i]);
import{M as w,N as R,O as M,P as K,dA as J,bS as k,d_ as B,G as C,J as L,U,gq as z,o as N,_ as q,cJ as Y,dm as H,dn as X,cl as Z,aP as b,S as tt,dB as I,gr as et,gs as nt}from"./index-GOO0DjDp.js";import{i as T,b as d,r as m,V as rt,l as W,P as v,al as at,Y as ot,N as j,E as x,Q as it,z as D,S as G,G as st,F as lt,am as ut,an as E,ao as ct}from"./arcadeUtils-e4Pa2B2w.js";import{l as ft}from"./portalUtils-CoYUMXVn.js";import{s as pt,m as dt,t as mt,p as ht,c as gt}from"./Relationship-CdQdDK5m.js";import"./ImmutableArray-BPVd6ESQ.js";import"./number-CfyHDTOl.js";import"./featureConversionUtils-DVuAsAiD.js";let f=class extends K{constructor(t){super(t),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const t=this.geometries.map(o=>o.toJSON()),e=this.geometries[0],r={};return r.outSR=J(this.outSpatialReference),r.inSR=J(e.spatialReference),r.geometries=JSON.stringify({geometryType:k(e),geometries:t}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};w([R()],f.prototype,"geometries",void 0),w([R({json:{read:{source:"outSR"}}})],f.prototype,"outSpatialReference",void 0),w([R()],f.prototype,"transformation",void 0),w([R()],f.prototype,"transformForward",void 0),f=w([M("esri.rest.support.ProjectParameters")],f);const A=f,wt=B(A);async function yt(t,e,r){e=wt(e);const o=C(t),i={...o.query,f:"json",...e.toJSON()},n=e.outSpatialReference,a=k(e.geometries[0]),l=L(i,r);return U(o.path+"/project",l).then(({data:{geometries:u}})=>z(u,a,n))}let h=null;async function St(t){const e=Y.geometryServiceUrl??"";if(!e){H()||await X();for(const n of t)n.container[n.indexer]=Z(n.container[n.indexer],b.WGS84);return}const r=t.map(n=>n.container[n.indexer]),o=new A({geometries:r,outSpatialReference:b.WGS84}),i=await yt(e,o);for(let n=0;n<i.length;n++){const a=t[n];a.container[a.indexer]=i[n]}}async function O(t,e){const r=new tt({portal:t,id:e});return await r.load(),h===null&&(h=await q(()=>import("./knowledgeGraphService-jud1FaJD.js").then(o=>o.k),__vite__mapDeps([0,1,2,3]))),await h.fetchKnowledgeGraph(r.url)}function $(t,e,r,o,i){if(t===null)return null;if(v(t)||D(t))return t;if(G(t)||G(t))return t.toJSDate();if(st(t))return t.toStorageFormat();if(lt(t))return t.toStorageString();if(ut(t)){const n={};for(const a of t.keys())n[a]=$(t.field(a),e,r,o,i),n[a]instanceof I&&i.push({container:n,indexer:a});return n}if(x(t)){const n=t.map(a=>$(a,e,r,o,i));for(let a=0;a<n.length;a++)n[a]instanceof I&&i.push({container:n,indexer:a});return n}return E(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&e?et(t):t:void 0}function Rt(t,e){if(!t)return t;if(t.spatialReference.isWGS84&&e.spatialReference.isWebMercator)return nt(t);if(t.spatialReference.equals(e.spatialReference))return t;throw new d(e,m.WrongSpatialReference,null)}function P(t,e){if(!t)return null;const r={};for(const o in t)r[o]=y(t[o],e);return r}function y(t,e){return t===null?null:x(t)?t.map(r=>y(r,e)):t instanceof dt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:P(t.properties,e)}:t instanceof mt?{graphType:"object",properties:P(t.properties,e)}:t instanceof ht?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:P(t.properties,e)}:t instanceof gt?{graphType:"path",path:t.path?t.path.map(r=>y(r,e)):null}:E(t)?Rt(t,e):v(t)||D(t)||ct(t)?t:null}function Nt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(e,r){return t.standardFunctionAsync(e,r,(o,i,n)=>{var l,u;if(T(n,2,2,e,r),n[0]===null)throw new d(e,m.PortalRequired,r);if(n[0]instanceof rt){const p=W(n[1]);let g;return g=(l=e.services)!=null&&l.portal?e.services.portal:N.getDefault(),O(ft(n[0],g),p)}if(v(n[0])===!1)throw new d(e,m.InvalidParameter,r);const a=W(n[0]);return O(((u=e.services)==null?void 0:u.portal)??N.getDefault(),a)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(e,r){return t.standardFunctionAsync(e,r,async(o,i,n)=>{var F;T(n,2,4,e,r);const a=n[0];if(!at(a))throw new d(e,m.InvalidParameter,r);const l=n[1];if(!v(l))throw new d(e,m.InvalidParameter,r);h===null&&(h=await q(()=>import("./knowledgeGraphService-jud1FaJD.js").then(s=>s.k),__vite__mapDeps([0,1,2,3])));let u=null;const p=ot(n[2],null);if(!(p instanceof j||p===null))throw new d(e,m.InvalidParameter,r);if(p){let s=[];u=$(p,!0,!1,e,s),s=s.filter(c=>!c.container[c.indexer].spatialReference.isWGS84),s.length>0&&await St(s)}const g=new pt({openCypherQuery:l,bindParameters:u});(((F=a==null?void 0:a.serviceDefinition)==null?void 0:F.currentVersion)??11.3)>11.2&&(g.outputSpatialReference=e.spatialReference);const Q=(await h.executeQueryStreaming(a,g)).resultRowsStream.getReader(),_=[];try{for(;;){const{done:s,value:c}=await Q.read();if(s)break;if(x(c))for(const S of c)_.push(y(S,e));else{const S=[];for(const V of c)S.push(y(c[V],e));_.push(S)}}}catch(s){throw s}return j.convertJsonToArcade(_,it(e),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Nt as registerFunctions};
