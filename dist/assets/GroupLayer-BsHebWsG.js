const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/groupLayerUtils-Cxx7cGpY.js","assets/utils-CYM9l9Oc.js","assets/index-GOO0DjDp.js","assets/index-D7_X1F0b.css","assets/originUtils-D69mHv66.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/jsonContext-CbvIEB6E.js","assets/saveUtils-CGbtHkHp.js","assets/resourceUtils-DW9YqCr8.js","assets/resourceUtils-CVHf2dlv.js"])))=>i.map(i=>d[i]);
import{M as l,N as d,O as b,ac as m,W as y,fS as g,cS as _,c7 as w,cD as I,cH as $,cF as S,cG as O,cI as A,dM as M,bF as p,d9 as x,h9 as V,S as P,aI as C,ds as E,f0 as h,gL as T,dc as v,aO as F,go as H,bH as R,bI as f,_ as G}from"./index-GOO0DjDp.js";import{n as L}from"./CollectionFlattener-DHMge4Xy.js";import{a as j}from"./lazyLayerLoader-CrwIAOU9.js";import{r as B}from"./saveUtils-CGbtHkHp.js";function D(e){return new L({getCollections:()=>[e.tables,e.layers],getChildrenFunction:i=>{const t=[];return"tables"in i&&t.push(i.tables),"layers"in i&&t.push(i.layers),t},itemFilterFunction:i=>{const t=i.parent;return!!t&&"tables"in t&&t.tables.includes(i)}})}function u(e,i,t){let s,a;if(e)for(let o=0,r=e.length;o<r;o++){if(s=e.at(o),(s==null?void 0:s[i])===t)return s;if((s==null?void 0:s.type)==="group"&&(a=u(s.layers,i,t),a))return a}}const N=e=>{let i=class extends e{constructor(...t){super(...t),this.layers=new m;const s=r=>{r.parent&&"remove"in r.parent&&r.parent.remove(r)},a=r=>{r.parent=this,this.layerAdded(r),r.type!=="elevation"&&r.type!=="base-elevation"||y.getLogger(this).error(`Layer 'title:${r.title}, id:${r.id}' of type '${r.type}' is not supported as an operational layer and will therefore be ignored.`)},o=r=>{r.parent=null,this.layerRemoved(r)};this.addHandles([this.layers.on("before-add",r=>{if(r.item===this)return r.preventDefault(),void y.getLogger(this).error("#add()","Cannot add layer to itself.");s(r.item)}),this.layers.on("after-add",r=>a(r.item)),this.layers.on("after-remove",r=>o(r.item))])}destroy(){const t=this.layers.toArray();for(const s of t)s.destroy();this.layers.destroy()}set layers(t){this._set("layers",g(t,this._get("layers")))}add(t,s){const a=this.layers;if(s=a.getNextIndex(s),t instanceof _){const o=t;o.parent===this?this.reorder(o,s):a.add(o,s)}else w(t)?t.then(o=>{this.destroyed||this.add(o,s)}):y.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(t,s){const a=this.layers;let o=a.getNextIndex(s);t.slice().forEach(r=>{r.parent!==this?(a.add(r,o),o+=1):this.reorder(r,o)})}findLayerById(t){return u(this.layers,"id",t)}findLayerByUid(t){return u(this.layers,"uid",t)}remove(t){return this.layers.remove(t)}removeMany(t){return this.layers.removeMany(t)}removeAll(){return this.layers.removeAll()}reorder(t,s){return this.layers.reorder(t,s)}layerAdded(t){}layerRemoved(t){}};return l([d()],i.prototype,"layers",null),i=l([b("esri.support.LayersMixin")],i),i};function c(e,i,t){if(e)for(let s=0,a=e.length;s<a;s++){const o=e.at(s);if(o[i]===t)return o;if((o==null?void 0:o.type)==="group"){const r=c(o.tables,i,t);if(r)return r}}}const k=e=>{let i=class extends e{constructor(...t){super(...t),this.tables=new m,this.addHandles([this.tables.on("after-add",s=>{const a=s.item;a.parent&&a.parent!==this&&"tables"in a.parent&&a.parent.tables.remove(a),a.parent=this,a.type!=="feature"&&y.getLogger(this).error(`Layer 'title:${a.title}, id:${a.id}' of type '${a.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",s=>{s.item.parent=null})])}destroy(){const t=this.tables.toArray();for(const s of t)s.destroy();this.tables.destroy()}set tables(t){this._set("tables",g(t,this._get("tables")))}findTableById(t){return c(this.tables,"id",t)}findTableByUid(t){return c(this.tables,"uid",t)}};return l([d()],i.prototype,"tables",null),i=l([b("esri.support.TablesMixin")],i),i},U=Symbol("WebScene");let n=class extends I($(S(O(k(N(A(_))))))){constructor(e){super(e),this.allLayers=new L({getCollections:()=>[this.layers],getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=D(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=M(async(i,t,s)=>{const{save:a,saveAs:o}=await G(()=>import("./groupLayerUtils-Cxx7cGpY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));switch(i){case h.SAVE:return a(this,t);case h.SAVE_AS:return o(this,s,t)}})}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([p(()=>{let e=this.parent;for(;e&&"parent"in e&&e.parent;)e=e.parent;return e&&U in e},e=>{const i="prevent-adding-tables";this.removeHandles(i),e&&(this.tables.removeAll(),this.addHandles(R(()=>this.tables,"before-add",t=>{t.preventDefault(),y.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")}),i))},H),p(()=>this.visible,this._onVisibilityChange.bind(this),f)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===x.USER}_writeLayers(e,i,t,s){const a=[];if(!e)return a;e.forEach(o=>{const r=V(o,s.webmap?s.webmap.getLayerJSONFromResourceInfo(o):null,s);r!=null&&r.layerType&&a.push(r)}),i.layers=a}set portalItem(e){this._set("portalItem",e)}readPortalItem(e,i,t){const{itemId:s,layerType:a}=i;if(a==="GroupLayer"&&s)return new P({id:s,portal:t==null?void 0:t.portal})}writePortalItem(e,i){e!=null&&e.id&&(i.itemId=e.id)}set visibilityMode(e){const i=this._get("visibilityMode")!==e;this._set("visibilityMode",e),i&&this._enforceVisibility(e,this.visible)}async beforeSave(){return B(this)}load(e){const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service"],layerModuleTypeMap:j},e).catch(t=>{if(C(t),this.sourceIsPortalItem)throw t});return this.addResolvingPromise(i),Promise.resolve(this)}async loadAll(){return E(this,e=>{e(this.layers,this.tables)})}async save(e){return this._debouncedSaveOperations(h.SAVE,e)}async saveAs(e,i){return this._debouncedSaveOperations(h.SAVE_AS,i,e)}layerAdded(e){e.visible&&this.visibilityMode==="exclusive"?this._turnOffOtherLayers(e):this.visibilityMode==="inherited"&&(e.visible=this.visible),this.hasHandles(e.uid)?console.error(`Layer read to Grouplayer: uid=${e.uid}`):this.addHandles(p(()=>e.visible,i=>this._onChildVisibilityChange(e,i),f),e.uid)}layerRemoved(e){this.removeHandles(e.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach(i=>{i!==e&&(i.visible=!1)})}_enforceVisibility(e,i){if(!T(this).initialized)return;const t=this.layers;let s=t.find(a=>a.visible);switch(e){case"exclusive":t.length&&!s&&(s=t.at(0),s.visible=!0),this._turnOffOtherLayers(s);break;case"inherited":t.forEach(a=>{a.visible=i})}}_onVisibilityChange(e){this.visibilityMode==="inherited"&&this.layers.forEach(i=>{i.visible=e})}_onChildVisibilityChange(e,i){switch(this.visibilityMode){case"exclusive":i?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case"inherited":e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(e=>e.visible)}};l([d({readOnly:!0,dependsOn:[]})],n.prototype,"allLayers",void 0),l([d({readOnly:!0})],n.prototype,"allTables",void 0),l([d({json:{read:!0,write:!0}})],n.prototype,"blendMode",void 0),l([d()],n.prototype,"fullExtent",void 0),l([d({readOnly:!0})],n.prototype,"sourceIsPortalItem",null),l([d({json:{read:!1,write:{ignoreOrigin:!0}}})],n.prototype,"layers",void 0),l([v("layers")],n.prototype,"_writeLayers",null),l([d({type:["GroupLayer"]})],n.prototype,"operationalLayerType",void 0),l([d({json:{origins:{"web-map":{read:!1,write:{overridePolicy(e,i,t){return{enabled:(e==null?void 0:e.type)==="Group Layer"&&(t==null?void 0:t.initiator)!==this}}}},"web-scene":{read:!1,write:!1}}}})],n.prototype,"portalItem",null),l([F("web-map","portalItem",["itemId"])],n.prototype,"readPortalItem",null),l([v("web-map","portalItem",{itemId:{type:String}})],n.prototype,"writePortalItem",null),l([d()],n.prototype,"spatialReference",void 0),l([d({json:{read:!1},readOnly:!0,value:"group"})],n.prototype,"type",void 0),l([d({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(e,i,t)=>{e!=="inherited"&&(i[t]=e)}}}}})],n.prototype,"visibilityMode",null),n=l([b("esri.layers.GroupLayer")],n);const K=n;export{K as default};
