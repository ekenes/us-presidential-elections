{"version":3,"file":"EditableLabel-CZT0lLjI.js","sources":["../../node_modules/@amcharts/amcharts5/.internal/core/render/EditableLabel.js"],"sourcesContent":["import { Label } from \"./Label\";\r\nimport { Container } from \"./Container\";\r\nimport { RoundedRectangle } from \"./RoundedRectangle\";\r\nimport { Percent } from \"../util/Percent\";\r\nimport { color } from \"../util/Color\";\r\nimport { MultiDisposer } from \"../util/Disposer\";\r\nimport * as $utils from \"../util/Utils\";\r\nimport * as $type from \"../util/Type\";\r\nimport * as $array from \"../util/Array\";\r\n/**\r\n * Editable label.\r\n *\r\n * @since 5.9.5\r\n */\r\nexport class EditableLabel extends Label {\r\n    constructor() {\r\n        super(...arguments);\r\n        Object.defineProperty(this, \"_editOnEvents\", {\r\n            enumerable: true,\r\n            configurable: true,\r\n            writable: true,\r\n            value: void 0\r\n        });\r\n    }\r\n    _afterNew() {\r\n        super._afterNew();\r\n        const input = this.children.push(Container.new(this._root, {\r\n            html: \"<textarea class=\\\"am5-editable-label\\\"></textarea>\",\r\n            isMeasured: false\r\n        }));\r\n        input.hide();\r\n        this.setPrivate(\"input\", input);\r\n        // Set background\r\n        let background = this.get(\"background\");\r\n        if (!background) {\r\n            background = this.set(\"background\", RoundedRectangle.new(this._root, {\r\n                themeTags: [\"editablelabel\", \"background\"]\r\n            }));\r\n        }\r\n        else {\r\n            background.set(\"themeTags\", [\"editablelabel\", \"background\"]);\r\n        }\r\n    }\r\n    _beforeChanged() {\r\n        super._beforeChanged();\r\n        // If editOn setting is changed, remove old listeners\r\n        if (this.isDirty(\"editOn\")) {\r\n            if (this._editOnEvents) {\r\n                this._editOnEvents.dispose();\r\n            }\r\n            const editOn = this.get(\"editOn\", \"click\");\r\n            if (editOn != \"none\") {\r\n                this._editOnEvents = new MultiDisposer([\r\n                    this.getPrivate(\"input\").events.on(editOn, (_ev) => {\r\n                        // this is here just to make it interactive\r\n                    }),\r\n                    this.events.on(editOn, (_ev) => {\r\n                        this.set(\"active\", true);\r\n                    })\r\n                ]);\r\n            }\r\n        }\r\n    }\r\n    _prepareChildren() {\r\n        super._prepareChildren();\r\n        this._maybeInitTextarea();\r\n    }\r\n    _updateChildren() {\r\n        super._updateChildren();\r\n        if (this.isDirty(\"active\")) {\r\n            const editing = this.get(\"active\", false);\r\n            if (editing) {\r\n                this._startEditing();\r\n            }\r\n            else {\r\n                this._stopEditing();\r\n            }\r\n            const bg = this.get(\"background\");\r\n            if (bg) {\r\n                bg.set(\"active\", editing);\r\n            }\r\n        }\r\n        ;\r\n        this._syncText();\r\n        this._syncStyle();\r\n    }\r\n    _maybeInitTextarea() {\r\n        if (!this._isInited()) {\r\n            const input = this.getPrivate(\"input\");\r\n            if (input && input.getPrivate(\"htmlElement\")) {\r\n                const el = input.getPrivate(\"htmlElement\");\r\n                const textarea = el.querySelector(\".am5-editable-label\");\r\n                if (textarea) {\r\n                    this.setPrivate(\"textarea\", textarea);\r\n                    // Resize textarea on keypress\r\n                    textarea.addEventListener(\"input\", _ev => {\r\n                        if (this.get(\"multiLine\") === false) {\r\n                            // replace line breaks with spaces for single-line labels\r\n                            textarea.value = textarea.value.replace(/\\n/g, \" \");\r\n                        }\r\n                        this.set(\"text\", textarea.value);\r\n                        this._syncStyle();\r\n                    });\r\n                    // Finish editing on blur\r\n                    textarea.addEventListener(\"blur\", _ev => this.set(\"active\", false));\r\n                    // Finish editing on ESC press\r\n                    if ($utils.supports(\"keyboardevents\")) {\r\n                        this._disposers.push($utils.addEventListener(document, \"keydown\", (ev) => {\r\n                            if ($utils.getEventKey(ev) == \"Escape\") {\r\n                                this.set(\"active\", false);\r\n                            }\r\n                        }));\r\n                    }\r\n                    // Intercept ENTER if necessary\r\n                    this._disposers.push($utils.addEventListener(document, \"keydown\", (ev) => {\r\n                        if ($utils.getEventKey(ev) == \"Enter\" && this.get(\"multiLine\") === false) {\r\n                            // Single-line label, save instead of breaking into new line\r\n                            ev.preventDefault();\r\n                            this.set(\"active\", false);\r\n                        }\r\n                    }));\r\n                    this.events.dispatch(\"inited\", {\r\n                        type: \"inited\",\r\n                        target: this\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _isInited() {\r\n        return this.getPrivate(\"textarea\") ? true : false;\r\n    }\r\n    _startEditing() {\r\n        if (!this._isInited()) {\r\n            this.events.once(\"inited\", () => {\r\n                this._startEditing();\r\n            });\r\n            return;\r\n        }\r\n        this._text.set(\"opacity\", 0);\r\n        const input = this.getPrivate(\"input\");\r\n        const textarea = this.getPrivate(\"textarea\");\r\n        if (textarea) {\r\n            if (this.get(\"text\", \"\") == \"\") {\r\n                this.set(\"text\", \" \");\r\n            }\r\n            input.show(0);\r\n            this.setTimeout(() => {\r\n                // size textarea to fit its actual content\r\n                this._syncStyle();\r\n                textarea.focus();\r\n            }, 100);\r\n        }\r\n    }\r\n    _stopEditing() {\r\n        if (!this._isInited()) {\r\n            this.events.once(\"inited\", () => {\r\n                this._stopEditing();\r\n            });\r\n            return;\r\n        }\r\n        const input = this.getPrivate(\"input\");\r\n        const textarea = this.getPrivate(\"textarea\");\r\n        if (textarea) {\r\n            this.set(\"text\", textarea.value);\r\n            input.hide(0);\r\n            this._text.set(\"opacity\", 1);\r\n        }\r\n    }\r\n    _syncStyle() {\r\n        const input = this.getPrivate(\"input\");\r\n        const textarea = this.getPrivate(\"textarea\");\r\n        const el = input.getPrivate(\"htmlElement\");\r\n        if (textarea && el) {\r\n            // Set up HTML\r\n            // Reset all styles\r\n            const computedStyles = window.getComputedStyle(textarea);\r\n            $array.each(computedStyles, (style) => {\r\n                textarea.style[style] = \"initial\";\r\n            });\r\n            // Remove textarea attributes\r\n            textarea.style.color = this.get(\"fill\", color(0x000000)).toCSS(this.get(\"fillOpacity\", 1));\r\n            textarea.style.backgroundColor = \"rgba(0, 0, 0, 0)\";\r\n            textarea.style.border = \"none\";\r\n            textarea.style.outline = \"none\";\r\n            textarea.style.padding = \"0\";\r\n            // Wrapping\r\n            textarea.wrap = \"off\";\r\n            textarea.style.resize = \"none\";\r\n            // Place carret under mouse cursor\r\n            // @todo\r\n            // Size\r\n            textarea.style.overflow = \"hidden\";\r\n            const maxWidth = this.get(\"maxWidth\", 0) - this.get(\"paddingLeft\", 0) - this.get(\"paddingRight\", 0);\r\n            if (maxWidth > 0) {\r\n                textarea.style.maxWidth = maxWidth + \"px\";\r\n            }\r\n            else {\r\n                // The actual minWidth will be set on frameend\r\n                textarea.style.minWidth = \"\";\r\n            }\r\n            textarea.style.height = \"auto\";\r\n            textarea.style.minHeight = textarea.scrollHeight + \"px\";\r\n            // If width is explicitly set on a label, use it for textarea\r\n            if (this.get(\"width\")) {\r\n                textarea.style.width = (this.width() - this.get(\"paddingLeft\", 0) - this.get(\"paddingRight\", 0)) + \"px\";\r\n                textarea.style.minWidth = \"\";\r\n            }\r\n            // Line height\r\n            const lineHeight = this.get(\"lineHeight\");\r\n            if (!lineHeight) {\r\n                textarea.style.lineHeight = \"1.2\";\r\n            }\r\n            else if (lineHeight instanceof Percent) {\r\n                textarea.style.lineHeight = lineHeight.value + \"\";\r\n            }\r\n            else if ($type.isNumber(lineHeight)) {\r\n                textarea.style.lineHeight = lineHeight + \"\";\r\n            }\r\n            // Font stuff\r\n            let fontFamily = this.get(\"fontFamily\");\r\n            if (!fontFamily) {\r\n                fontFamily = getComputedStyle(el, \"font-family\").getPropertyValue(\"font-family\");\r\n            }\r\n            textarea.style.fontFamily = fontFamily;\r\n            let fontSize = this.get(\"fontSize\");\r\n            if (!fontSize) {\r\n                fontSize = getComputedStyle(el, \"font-size\").getPropertyValue(\"font-size\");\r\n            }\r\n            else if ($type.isNumber(fontSize)) {\r\n                fontSize = fontSize + \"px\";\r\n            }\r\n            else {\r\n                fontSize = fontSize;\r\n            }\r\n            textarea.style.fontSize = fontSize;\r\n            let fontWeight = this.get(\"fontWeight\");\r\n            if (!fontWeight) {\r\n                fontWeight = getComputedStyle(el, \"font-weight\").getPropertyValue(\"font-weight\");\r\n            }\r\n            else {\r\n                fontWeight = fontWeight;\r\n            }\r\n            textarea.style.fontWeight = fontWeight;\r\n            let fontStyle = this.get(\"fontStyle\");\r\n            if (!fontStyle) {\r\n                fontStyle = getComputedStyle(el, \"font-style\").getPropertyValue(\"font-style\");\r\n            }\r\n            else {\r\n                fontStyle = fontStyle;\r\n            }\r\n            textarea.style.fontStyle = fontStyle;\r\n            const oversizeBehavior = this.get(\"oversizedBehavior\");\r\n            if (oversizeBehavior == \"wrap\") {\r\n                textarea.style.whiteSpace = \"pre-wrap\";\r\n            }\r\n            else {\r\n                textarea.style.whiteSpace = \"nowrap\";\r\n            }\r\n            // Adjust textarea postion based on textAlign setting\r\n            this._root.events.on(\"frameended\", () => {\r\n                if (textarea.style.minWidth == \"\") {\r\n                    textarea.style.minWidth = (textarea.scrollWidth + 20) + \"px\";\r\n                }\r\n                const textAlign = this.get(\"textAlign\", \"start\");\r\n                if (textAlign == \"center\") {\r\n                    textarea.style.textAlign = \"center\";\r\n                    if (!el.style.transform.match(/translateX/) && !this.get(\"width\")) {\r\n                        el.style.transform += \" translateX(-50%)\";\r\n                    }\r\n                }\r\n                else if (textAlign == \"end\") {\r\n                    textarea.style.textAlign = \"right\";\r\n                    if (!el.style.transform.match(/translateX/) && !this.get(\"width\")) {\r\n                        el.style.transform += \" translateX(-100%)\";\r\n                    }\r\n                }\r\n                else {\r\n                    textarea.style.textAlign = textAlign;\r\n                }\r\n            });\r\n        }\r\n    }\r\n    _syncText() {\r\n        const textarea = this.getPrivate(\"textarea\");\r\n        let text = this.get(\"text\", \"\");\r\n        if (text == \" \") {\r\n            text = \"\";\r\n        }\r\n        if (textarea) {\r\n            textarea.value = text;\r\n        }\r\n    }\r\n}\r\nObject.defineProperty(EditableLabel, \"className\", {\r\n    enumerable: true,\r\n    configurable: true,\r\n    writable: true,\r\n    value: \"EditableLabel\"\r\n});\r\nObject.defineProperty(EditableLabel, \"classNames\", {\r\n    enumerable: true,\r\n    configurable: true,\r\n    writable: true,\r\n    value: Label.classNames.concat([EditableLabel.className])\r\n});\r\n//# sourceMappingURL=EditableLabel.js.map"],"names":["EditableLabel","Label","input","Container","background","RoundedRectangle","editOn","MultiDisposer","_ev","editing","bg","textarea","$utils.supports","$utils.addEventListener","ev","$utils.getEventKey","el","computedStyles","$array.each","style","color","maxWidth","lineHeight","Percent","$type.isNumber","fontFamily","fontSize","fontWeight","fontStyle","textAlign","text"],"mappings":"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","x_google_ignoreList":[0]}