{"version":3,"file":"GridSnappingEngine-CygvHwko.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/GridSnappingEngine.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Accessor.js\";import r from\"../../../core/Logger.js\";import{deg2rad as i}from\"../../../core/mathUtils.js\";import{convertUnit as n}from\"../../../core/unitUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{K as a}from\"../../../chunks/vec32.js\";import{isLoadedOrLoadFor as p,project as l}from\"../../../geometry/projectionUtils.js\";import{getClosestDenormalizedXToReference as c}from\"../../../geometry/support/normalizeUtils.js\";import{getResolutionForScale as u}from\"../../../geometry/support/scaleUtils.js\";import{minimumPixelsPerStrideForDisplayWhenScalingOff as d}from\"../../2d/grid/constants.js\";import{getScaleFactor as g,measureMetersPerUnitAtReferencePoint as f}from\"../../2d/grid/gridUtils.js\";import{create as h,createWritable as m}from\"../sketch/normalizedPoint.js\";import{gridPlacementGraphicSymbol as S}from\"./snappingUtils.js\";import{IntersectionSnappingCandidate as y}from\"./candidates/IntersectionSnappingCandidate.js\";import{LineSnappingCandidate as v}from\"./candidates/LineSnappingCandidate.js\";let w=class extends e{constructor(t){super(t),this.options=null}destroy(){this._set(\"options\",null)}get grid(){return this.view.grid}get effectiveViewRotation(){return this.grid?.rotateWithMap?0:i(this.view.rotation??0)}get gridRotation(){return i(this.grid?.rotation??0)}get gridCenter(){const{spatialReference:t,grid:e}=this;if(!e||!t||!p(e.center.spatialReference,t))return null;try{const r=l(e.center,t),i=t.isWrappable&&null!=this.view?.center?c(r.x,this.view.center.x,t):r.x;return h(i,r.y,r.z)}catch(i){return r.getLogger(this).errorOnce(\"Grid Snapping - Failed to project grid center.\",i),null}}get offsetScaleFactor(){const{pixelsPerStride:t,grid:e}=this;if(!e||!t)return 1;const{majorLineInterval:r,dynamicScaling:i}=e;return r<1?null:g(r,t,i)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){const{grid:t}=this;return t?n(t.spacing,t.units,\"meters\"):null}get viewMetersPerPixel(){const{viewMetersPerSRUnit:t}=this;return null==t?null:t*u(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){const{spatialReference:t}=this.view;return this.gridCenter?f(this.gridCenter[0],this.gridCenter[1],t):null}get pixelsPerStride(){const{gridMetersPerStride:t,viewMetersPerPixel:e}=this;return e&&t?t/e:null}get updating(){return null!=this.grid&&null!=this.spatialReference&&null==this.viewMetersPerSRUnit}async fetchCandidates(t,e,r){const{options:i,view:n}=this;if(!i?.effectiveGridEnabled||!n.grid||r.feature?.attributes&&S in r.feature.attributes)return[];const o=r.coordinateHelper.arrayToPoint(t),s=i.distance*(\"touch\"===r.pointer?i.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(o,s)}fetchCandidatesSync(t,e){const r=[],{grid:i,effectiveViewRotation:n,gridRotation:o,gridCenter:s,viewMetersPerPixel:a,viewMetersPerSRUnit:c,offsetScaleFactor:u,spatialReference:g,gridMetersPerStride:f,pixelsPerStride:m}=this;if(!(i&&a&&c&&s&&g&&u&&f&&m))return r;if(!i.dynamicScaling&&m<d)return r;if(!p(t.spatialReference,g))return r;const S=l(t,g),w=h(S.x,S.y,S.z),x=P(w,-o,s,-n),C=f/c*u,U=j(x,C,s),{shouldSnapX:b,shouldSnapY:L}=R(U,x,e,a,c);if(!b&&!L)return[];const z=h((b?U:x)[0],(L?U:x)[1]),E=P(z,o,s,n),F=P(U,o,s,n);if(L){const t=M(U,x,C,\"y\"),e=P(t,o,s,n);r.push(new v({lineStart:F,lineEnd:e,targetPoint:E,isDraped:!1}))}if(b){const t=M(U,x,C,\"x\"),e=P(t,o,s,n);r.push(new v({lineStart:F,lineEnd:e,targetPoint:E,isDraped:!1}))}return b&&L&&r.push(new y(E,r[0],r[1],!1)),r}};t([o({constructOnly:!0})],w.prototype,\"view\",void 0),t([o()],w.prototype,\"options\",void 0),t([o()],w.prototype,\"grid\",null),t([o()],w.prototype,\"effectiveViewRotation\",null),t([o()],w.prototype,\"gridRotation\",null),t([o()],w.prototype,\"gridCenter\",null),t([o()],w.prototype,\"offsetScaleFactor\",null),t([o()],w.prototype,\"spatialReference\",null),t([o()],w.prototype,\"gridMetersPerStride\",null),t([o()],w.prototype,\"viewMetersPerPixel\",null),t([o()],w.prototype,\"viewMetersPerSRUnit\",null),t([o()],w.prototype,\"pixelsPerStride\",null),t([o()],w.prototype,\"updating\",null),w=t([s(\"esri.views.interactive.snapping.GridSnappingEngine\")],w);const P=(t,e,r,i)=>{const n=m(t[0],t[1],t[2]);return a(n,a(n,n,r,e),r,i)},j=(t,e,r)=>{const i=(t[0]-r[0])/e,n=(t[1]-r[1])/e,o=Math.trunc(i),s=Math.trunc(n),a=Math.round(i%1),p=Math.round(n%1),l=r[0]+(o+a)*e,c=r[1]+(s+p)*e;return h(l,c)},R=(t,e,r,i,n)=>{if(i<=0)return{shouldSnapX:!1,shouldSnapY:!1};const o=(t[0]-e[0])/i,s=(t[1]-e[1])/i;return{shouldSnapX:Math.abs(o*n)<r,shouldSnapY:Math.abs(s*n)<r}},M=(t,e,r,i)=>{if(\"y\"===i){const i=e[0]>t[0]?1:-1;return h(t[0]+r*i,t[1])}const n=e[1]>t[1]?1:-1;return h(t[0],t[1]+r*n)};export{w as GridSnappingEngine};\n"],"names":["w","e","_a","i","p","l","c","h","r","g","n","u","f","S","o","s","t","a","m","d","x","P","C","U","j","b","L","R","E","F","M","v","y"],"mappings":"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","x_google_ignoreList":[0]}