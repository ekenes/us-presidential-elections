{"version":3,"file":"FlowWorker-rq1rTW__.js","sources":["../../node_modules/@arcgis/core/views/3d/support/flow/FlowQuery3D.js","../../node_modules/@arcgis/core/views/3d/support/flow/loadUtils.js","../../node_modules/@arcgis/core/views/3d/support/flow/FlowWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{Cyclical as t}from\"../../../../core/Cyclical.js\";import{height as e,fromExtent as n}from\"../../../../geometry/support/aaBoundingRect.js\";import{getInfo as i}from\"../../../../geometry/support/spatialReferenceUtils.js\";class o{constructor(t,e,n,i,o){this.extent=t,this.timeExtent=e,this.size=n,this.pixelRatio=i,this.time=o}get flowExtentInfo(){return{modelSize:this.size,valid:i(this.extent.spatialReference)?.valid,extent:n(this.extent)}}insideMapExtent(t,e){return r(this.flowExtentInfo,t,e)}modelToMapSpace(t,e,n){return l(this.flowExtentInfo,t,e,n)}}function r(t,e,n){const{extent:i,valid:o}=t,[r,l,s,a]=i;return!(n<l||n>a)&&(null!=o&&r>s?e>=s||e<=r:e>=r&&e<=s)}function l(n,i,o,r){const{extent:l,modelSize:s,valid:u}=n,[c,f,x]=l,m=a(c,x,u);let p=i/s[0]*m+c;if(null!=u&&r){p=new t(u[0],u[1]).normalize(p)}return[p,(s[1]-o)/s[1]*e(l)+f]}function s(t,e,n){return null!=n&&Math.abs(t-n.valid[0])<n.dx&&Math.abs(e-n.valid[1])<n.dx}function a(t,e,n){if(null!=n&&t>e){const[i,o]=n;return o-t+(e-i)}return e-t}export{o as FlowQuery3D,r as insideMapExtent,s as isFullExtent,l as modelToMapSpace,a as wrappedWidth};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{containsXY as t,width as n,height as e,create as r}from\"../../../../geometry/support/aaBoundingRect.js\";import{createFlowFieldFromData as l}from\"../../../2d/engine/flow/dataUtils.js\";import{getFeatureTileId as o}from\"../../layers/support/FeatureTileDescriptor.js\";import{modelToMapSpace as i,insideMapExtent as u,isFullExtent as s}from\"./FlowQuery3D.js\";function f(t){return t?4:3}function a(t){return t[0].vertices instanceof Float32Array}class c{constructor(t,n,e,r,l,o){this.data=t,this.mask=n,this.width=e,this.height=r,this.lij=l,this.extent=o}}function h(t){return o(t.lij[0],t.lij[1],t.lij[2])}function m(t,n){let[e,l,o,i]=[null,null,null,null];for(const r of t){const t=r.extent;e=p(t[0],e),l=p(t[1],l),o=d(t[2],o),i=d(t[3],i)}if(null==e||null==l||null==o||null==i)return null;if(s(e,o,n)){const n=[...t].toSorted((t,n)=>t.extent[0]-n.extent[0]);let r=n[0].extent[2],l=0,i=0,u=0;for(let t=1;t<n.length;t++){const[e,o,s]=n[t].extent;if(r<e&&(u++,l=r,i=e,u>1))break;r=Math.max(r,s)}1===u&&(e=i,o=l)}return r([e,l,o,i])}function d(t,n){return null==n?t:Math.max(t,n)}function p(t,n){return null==n?t:Math.min(t,n)}function x(r,o,s){const[f,a]=s.modelSize;let c=null;const h=new Map;o.forEach(t=>{h.set(t.lij,l(r,t))});const m=(n,e,r)=>t(n.extent,e,r);return(t,l)=>{const d=Math.round(t),p=Math.round(l);if(!r.wrapAround&&(d<0||d>=f||p<0||p>=a))return[0,0];const[x,j]=i(s,t,l,!0);if(!u(s,x,j))return[0,0];if(null==c||!m(c,x,j)){c=null;for(const[t,n]of o)if(m(n,x,j)){c=n;break}}if(null==c?.data)return[0,0];const g=h.get(c.lij);if(null==g)return[0,0];const{width:w,height:M,extent:y}=c;return g((x-y[0])/n(y)*w,M-(j-y[1])/e(y)*M)}}export{c as FlowDataTile,m as boundingRectOfTiles,x as createFlowFieldFromDataTiled,a as isFlowPathBuffer,h as tileToKey,f as valuesPerFlowVertex};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as t}from\"tslib\";import\"../../../../core/Logger.js\";import\"../../../../core/has.js\";import\"../../../../core/RandomLCG.js\";import\"../../../../core/Error.js\";import{subclass as e}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{createFlowFieldFromData as s,traceFlowPaths as r}from\"../../../2d/engine/flow/dataUtils.js\";import{createFlowFieldFromDataTiled as o,valuesPerFlowVertex as a}from\"./loadUtils.js\";let i=class{constructor(){this._tileData=new Map}async generateStreamlines(t){const{flowData:e,flowExtentInfo:r,needsMagnitude:o,simulationSettings:a,startPositions:i}=t,n=l(s(a,e),a,r.modelSize,o,i);return{result:{streamlines:n},transferList:n?.map(t=>t.vertices.buffer)}}async generateTiledStreamlines(t){const{flowDataTiles:e,flowExtentInfo:s,needsMagnitude:r,reset:a,simulationSettings:i,startPositions:n}=t;this._updateTileData(e,a);const c=l(o(i,this._tileData,s),i,s.modelSize,r,n);return{result:{streamlines:c},transferList:c?.map(t=>t.vertices.buffer)??[]}}_updateTileData(t,e){e&&this._tileData.forEach((e,s)=>{null==t.get(s)&&this._tileData.delete(s)}),t.forEach((t,e)=>{\"delete\"===t.type?this._tileData.delete(e):\"on-worker\"!==t.type&&\"waiting\"!==t.type&&this._tileData.set(e,t.data)})}};i=t([e(\"esri.views.3d.support.flow.FlowWorker\")],i);const n=i;function l(t,e,s,o,i){if(null==t)return;const n=r(e,t,s[0],s[1],{positions:i}),l=[],c=a(o);for(const{vertices:r,stage:a}of n){const t=new Float32Array(r.length*c);for(let e=0;e<r.length;e++)t[e*c]=r[e].x,t[e*c+1]=r[e].y,t[e*c+2]=r[e].t,o&&(t[e*c+3]=r[e].speed);l.push({vertices:t,stage:a,hasMagnitude:o})}return l}export{n as default};\n"],"names":["r","t","e","n","o","s","a","l","i","u","c","f","x","m","p","h","d","j","w","M","y"],"mappings":"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","x_google_ignoreList":[0,1,2]}