{"version":3,"file":"meshFeatureSet-DZK2ot7Z.js","sources":["../../node_modules/@arcgis/core/rest/support/meshFeatureSet.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"../../Graphic.js\";import t from\"../../core/Logger.js\";import{getOrCreateMapValue as r}from\"../../core/MapUtils.js\";import s from\"../../geometry/Extent.js\";import o from\"../../geometry/Mesh.js\";import n from\"../../geometry/SpatialReference.js\";import{ServiceAssetPart as a,ServiceAsset as u}from\"../../geometry/support/meshUtils/External.js\";import{getFormatIdMimeType as i}from\"../../layers/support/infoFor3D.js\";import f from\"./FeatureSet.js\";import{extractMeshFeatureOrigin as c,extractMeshFeatureTransform as m}from\"./meshFeatureAttributes.js\";const p=()=>t.getLogger(\"esri.rest.support.meshFeatureSet\");function l(t,r,s){const o=s.features;s.features=[],delete s.geometryType;const a=f.fromJSON(s);if(a.geometryType=\"mesh\",!s.assetMaps)return a;const u=g(r,s.assetMaps),i=t.sourceSpatialReference??n.WGS84,c=s.globalIdFieldName,{outFields:m}=t,p=null!=m&&m.length>0?y(m.includes(\"*\")?null:new Set(m)):()=>({});for(const n of o){const t=E(n,c,i,r,u);a.features.push(new e({geometry:t,attributes:p(n)}))}return a}function y(e){return({attributes:t})=>{if(!t)return{};if(!e)return t;for(const r in t)e.has(r)||delete t[r];return t}}function E(e,t,r,n,a){const u=e.attributes[t],i=a.get(u);if(null==i||!e.geometry)return null;const f=c(e.attributes,r,n.transformFieldRoles),p=s.fromJSON(e.geometry);p.spatialReference=r;const l=m(e.attributes,n.transformFieldRoles),y=r.isGeographic?\"local\":\"georeferenced\",E=d(i);return E?o.createWithExternalSource(f,E,{extent:p,transform:l,vertexSpace:y,unitConversionDisabled:!0}):o.createIncomplete(f,{extent:p,transform:l,vertexSpace:y})}var h;function g(e,t){const s=new Map;for(const o of t){const t=o.parentGlobalId;if(null==t)continue;const n=o.assetName,a=o.assetType,u=o.assetHash,f=o.assetURL,c=o.conversionStatus,m=o.seqNo,l=i(a,e.supportedFormats);if(!l){p().error(\"mesh-feature-set:unknown-format\",`Service returned an asset of type ${a}, but it does not list it as a supported type`);continue}const y=r(s,t,(()=>({files:new Map})));r(y.files,n,(()=>({name:n,type:a,mimeType:l,status:S(c),parts:[]}))).parts[m]={hash:u,url:f}}return s}function d(e){const t=Array.from(e.files.values()),r=new Array;for(const s of t){if(s.status!==h.COMPLETED)return null;const e=new Array;for(const t of s.parts){if(!t)return null;e.push(new a(t.url,t.hash))}r.push(new u(s.name,s.mimeType,e))}return{type:\"service\",assets:r}}function S(e){switch(e){case\"COMPLETED\":case\"SUBMITTED\":return h.COMPLETED;case\"INPROGRESS\":return h.PENDING;default:return h.FAILED}}!function(e){e[e.FAILED=0]=\"FAILED\",e[e.PENDING=1]=\"PENDING\",e[e.COMPLETED=2]=\"COMPLETED\"}(h||(h={}));export{g as assetMapFromAssetMapsJSON,E as extractMesh,l as meshFeatureSetFromJSON};\n"],"names":["p","t","l","r","s","o","a","f","u","g","n","c","m","y","E","e","i","d","h","S"],"mappings":"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","x_google_ignoreList":[0]}