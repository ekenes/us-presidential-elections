{"version":3,"file":"mapCollectionUtils-CPjN0as6.js","sources":["../../node_modules/@arcgis/core/core/mapCollectionUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"./asyncUtils.js\";import t from\"./Collection.js\";import{removeIfHandle as o,destroyHandle as s}from\"./handleUtils.js\";import{isAborted as r,createAbortError as n,ignoreAbortErrors as i}from\"./promiseUtils.js\";import{on as a}from\"./reactiveUtils.js\";function c(e,o,s){const r=s?.createCollection?.()??new t,n=!!s?.recycleItems?new d:null,i=(e,t=0)=>{if(!e?.length)return;const o=r.splice(t,e.length);n?n.processRemoved(e):o.forEach(m)},c=(e,t=0)=>{if(!e?.length)return;const s=[];for(const r of e){const e=n?.use(r);if(e)s.push(e);else{const e=o(r);n?.register(r,e),s.push(e)}}r.addMany(s,t)},l=a(e,\"after-splice\",({added:e,start:t,removed:o})=>{i(o,t),c(e,t)},{sync:!0,onListenerRemove:e=>i(e.items),onListenerAdd:e=>c(e.items)});return r.addHandles(l),r}class d{constructor(){this._originalToMapped=new Map,this._removedItemCandidates=new Set,this._garbageCollectionQueued=!1}processRemoved(e){if(!e?.length)return;const{_removedItemCandidates:t}=this;for(const o of e)this._getItem(o)?.markRemoved()&&(t.add(o),this._queueGarbageCollection())}use(e){const t=this._getItem(e);return t&&(t.removed=!1),t?.item}register(e,t){this._originalToMapped.set(e,new l(t))}_getItem(e){return this._originalToMapped.get(e)}_queueGarbageCollection(){this._garbageCollectionQueued||(this._garbageCollectionQueued=!0,queueMicrotask(()=>this._garbageCollectCandidates()))}_garbageCollectCandidates(){this._garbageCollectionQueued=!1;const{_removedItemCandidates:e}=this,t=Array.from(e);e.clear(),t.forEach(e=>this._garbageCollectIfRemoved(e))}_garbageCollectIfRemoved(e){const{_originalToMapped:t}=this,o=this._getItem(e);o?.removed&&(m(o.item),t.delete(e))}}class l{constructor(e){this.item=e,this.removed=!1}markRemoved(){return this.removed=!0,!0}}function m(e){\"object\"==typeof e&&e&&(\"destroy\"in e&&\"function\"==typeof e.destroy?e.destroy():o(e))}function u(o,a,d){const l=new t,u=c(o,t=>e(async e=>{const o=await a(t,e);if(r(e))throw m(o),n();return o}),d),f=()=>null,g=async e=>{const t=await e.promise,o=u.indexOf(e);o<0||l.splice(o,1,t)};l.addMany(u.items.map(f));for(const e of u)i(g(e));const h=u.on(\"after-splice\",({added:e,start:t,deleteCount:o})=>{const s=l.splice(t,o);for(const r of s)m(r);if(e?.length){l.addMany(e.map(f),t);for(const t of e)i(g(t))}});return l.addHandles([s(u),h]),l}export{c as mapCollection,u as mapCollectionAsync};\n"],"names":["c","e","s","r","_a","t","n","d","i","o","l","a","u","f","g","h"],"mappings":"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","x_google_ignoreList":[0]}