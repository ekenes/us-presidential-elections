import{en as F,cd as I,t as S,cn as w,c9 as h}from"./index-0sjr7qut.js";import{B as T,x as j,j as g}from"./queryUtils-CnlpgcTj.js";import{d as v,O,V as Q}from"./QueryEngine-18aH54Iw.js";import{I as q}from"./timeSupport-Cu1TV_0O.js";async function A(e,n,p){const a=F(p),{point:t,distance:i,returnEdge:f,vertexMode:o}=n;if(!f&&o==="none")return{candidates:[]};let r=I(n.query);r=await e.schedule((()=>T(r,e.definitionExpression,e.spatialReference)),a),r=await e.reschedule((()=>v(r,{availableFields:e.availableFields,fieldsIndex:e.fieldsIndex,geometryType:e.geometryType,spatialReference:e.spatialReference})),a);const u=!S(t.spatialReference,e.spatialReference);u&&await j(t.spatialReference,e.spatialReference);const m=typeof i=="number"?i:i.x,d=typeof i=="number"?i:i.y,y={xmin:t.x-m,xmax:t.x+m,ymin:t.y-d,ymax:t.y+d,spatialReference:t.spatialReference},s=u?g(y,e.spatialReference):y;if(!s)return{candidates:[]};const c=(await w(h(t),null,{signal:a}))[0],x=(await w(h(s),null,{signal:a}))[0];if(c==null||x==null)return{candidates:[]};const l=new O(await e.reschedule((()=>e.searchFeatures(Q(x.toJSON()))),a),r,e);await e.reschedule((()=>e.executeObjectIdsQuery(l)),a),await e.reschedule((()=>e.executeTimeQuery(l)),a),await e.reschedule((()=>e.executeAttributesQuery(l)),a),await e.reschedule((()=>E(e,l,a)),a);const R=c.toJSON(),b=u?g(R,e.spatialReference):R,$=u?Math.max(s.xmax-s.xmin,s.ymax-s.ymin)/2:i;return l.createSnappingResponse({...n,point:b,distance:$},r.returnZ,t.spatialReference)}async function E(e,n,p){var o;const{query:a}=n,{spatialRel:t}=a;if(!((o=n==null?void 0:n.items)!=null&&o.length)||!a.geometry||!t)return;const i=await q(t,a.geometry,e.geometryType,e.hasZ,e.hasM),f=await e.runSpatialFilter(n.items,(r=>i(r.geometry)),p);n.items=f}export{A as u};
//# sourceMappingURL=executeQueryForSnapping-C2ethWel.js.map
