{"version":3,"file":"OperatorGeneralize-WqWdY_Yt.js","sources":["../../node_modules/@arcgis/core/chunks/OperatorGeneralize.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{b as t,c as e}from\"./tslib.es6.js\";import{G as s}from\"./SimpleGeometryCursor.js\";import{a as i,c as r,e as a,G as n,f as h,h as m,t as l}from\"./Geometry.js\";import{a as o,P as c,L as u}from\"./MultiPathImpl.js\";import{P as _}from\"./Envelope.js\";import{h as g,P as p,c as k}from\"./Point2D.js\";import{O as f}from\"./OperatorDensify.js\";class P{getOperatorType(){return 10204}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,i){return new y(t,e,s,i)}execute(t,e,s,r){t||i(\"null param is not allowed.\");return new y(null,e,s,r).generalize(t)}}class y extends s{constructor(t,e,s,i){super(),this.m_pline=null,this.m_point=new _,this.m_stack=[],this.m_resultstack=[],this.m_callCount=0,this.m_progressTracker=i,this.m_geoms=t,this.m_maxDeviation=e,this.m_bRemoveDegenerateParts=s}tock(){return!0}getRank(){return 1}next(){const t=this.m_geoms.next();return null===t?null:(r(t),this.generalize(t))}getGeometryID(){return this.m_geoms.getGeometryID()}generalize(s){const i=s.getGeometryType();if(a(i))return s;if(i===n.enumEnvelope){const t=new o({vd:s.getDescription()});return t.addEnvelope(s,!1),this.generalize(t)}if(h(i)){const t=new c({vd:s.getDescription()});return t.addSegment(s,!0),this.generalize(t)}if(m(i)||l(\"\"),s.isEmpty()||this.m_maxDeviation<=0)return s;const r=(new f).execute(s,0,.05*this.m_maxDeviation,0,this.m_progressTracker);s.hasNonLinearSegments()&&(this.m_maxDeviation*=.95);const _=r,p=s.createInstance();if(p.getGeometryType()===n.enumPolygon){p.setFillRule(s.getFillRule())}this.m_xy=_.getAttributeStreamRef(0);{const s={stack:[],error:void 0,hasError:!1};try{const e=new u;this.m_pline=e,t(s,g((()=>{this.m_pline=null}),!1),!1);for(let t=0,s=_.getPathCount();t<s;t++)this.generalizePath(_.getImpl(),t,p.getImpl())}catch(k){s.error=k,s.hasError=!0}finally{e(s)}}return this.m_resultstack.length=0,this.m_stack.length=0,p}generalizePath(t,e,s){if(t.getPathSize(e)<2)return;this.m_resultstack.length=0,this.m_stack.length=0;const i=t.getPathStart(e),r=t.getPathEnd(e)-1,a=t.isClosedPath(e),n=t.isClosedPathInXYPlane(e);let h=0,m=-1;this.m_stack.push(a?i:r),this.m_stack.push(i);let l=!1,o=!1;for(!this.m_bRemoveDegenerateParts&&n&&(l=!0,o=!0);this.m_stack.length>1;){const e=this.m_stack.at(-1);this.m_stack.pop();const s=this.m_stack.at(-1);let i=t.getXY(e);this.m_pline.setStartXY(i),i=t.getXY(s),this.m_pline.setEndXY(i);const a=[Number.NaN];let n=this.findGreatestDistance(e,s,r,a);n>=0&&(l?l=!1:(o&&a[0]>h&&(h=a[0],m=n),a[0]<=this.m_maxDeviation&&(n=-1))),n>=0?(this.m_stack.push(n),this.m_stack.push(e)):this.m_resultstack.push(e)}a||this.m_resultstack.push(this.m_stack[0]);const c=this.m_resultstack.length;if(c===t.getPathSize(e)&&c===this.m_stack.length)s.addPath(t,e,!0);else if(this.m_resultstack.length>0){if(this.m_bRemoveDegenerateParts&&this.m_resultstack.length<=2){if(a||1===this.m_resultstack.length)return;if(p.distance(t.getXY(this.m_resultstack[0]),t.getXY(this.m_resultstack[1]))<=this.m_maxDeviation)return}if(o&&m>=0&&h<=this.m_maxDeviation){const t=this.m_resultstack.at(-1)>m;this.m_resultstack.push(m),t&&(this.m_resultstack[this.m_resultstack.length-2]=k(this.m_resultstack[this.m_resultstack.length-1],this.m_resultstack[this.m_resultstack.length-1]=this.m_resultstack[this.m_resultstack.length-2]))}for(let e=0,i=this.m_resultstack.length;e<i;e++)t.getPointByVal(this.m_resultstack[e],this.m_point),0===e?s.startPathPoint(this.m_point):s.lineToPoint(this.m_point);if(a){for(let t=this.m_resultstack.length;t<3;t++)s.lineToPoint(this.m_point);s.closePathWithLine()}}}findGreatestDistance(t,e,s,i){let r=e-1;e<=t&&(r=s);let a=-1,n=0;const h=new p;for(let m=t+1;m<=r;m++){this.m_xy.queryPoint2D(2*m,h);const t=h.x,e=h.y,s=this.m_pline.getClosestCoordinate(h,!1);h.assign(this.m_pline.getCoord2D(s)),h.x-=t,h.y-=e;const i=h.length();i>n&&(a=m,n=i),this.m_callCount++}return i[0]=n,a}}export{P as O};\n"],"names":["P","s","i","r","_","a","n","t","o","h","c","m","l","f","p","e","u","g","k"],"mappings":"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","x_google_ignoreList":[0]}