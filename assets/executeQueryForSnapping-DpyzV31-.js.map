{"version":3,"file":"executeQueryForSnapping-DpyzV31-.js","sources":["../../node_modules/@arcgis/core/layers/graphics/data/executeQueryForSnapping.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{clone as e}from\"../../../core/lang.js\";import{signalFromSignalOrOptions as t}from\"../../../core/promiseUtils.js\";import{fromJSON as r}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as a}from\"../../../geometry/support/normalizeUtils.js\";import{equals as i}from\"../../../geometry/support/spatialReferenceUtils.js\";import{checkProjectionSupport as s,project as n}from\"./projectionSupport.js\";import{getQueryBBoxes as o}from\"./QueryEngine.js\";import{QueryEngineResult as l}from\"./QueryEngineResult.js\";import{normalizeQueryLike as p}from\"./queryUtils.js\";import{validateQuery as m}from\"./queryValidationUtils.js\";import{getSpatialQueryOperator as c}from\"./spatialQuerySupport.js\";async function u(c,u,y){const d=t(y),{point:x,distance:g,returnEdge:R,vertexMode:j}=u;if(!R&&\"none\"===j)return{candidates:[]};let w=e(u.query);w=await c.schedule((()=>p(w,c.definitionExpression,c.spatialReference)),d),w=await c.reschedule((()=>m(w,{availableFields:c.availableFields,fieldsIndex:c.fieldsIndex,geometryType:c.geometryType,spatialReference:c.spatialReference})),d);const h=!i(x.spatialReference,c.spatialReference);h&&await s(x.spatialReference,c.spatialReference);const b=\"number\"==typeof g?g:g.x,Q=\"number\"==typeof g?g:g.y,S={xmin:x.x-b,xmax:x.x+b,ymin:x.y-Q,ymax:x.y+Q,spatialReference:x.spatialReference},U=h?n(S,c.spatialReference):S;if(!U)return{candidates:[]};const q=(await a(r(x),null,{signal:d}))[0],E=(await a(r(U),null,{signal:d}))[0];if(null==q||null==E)return{candidates:[]};const F=new l(await c.reschedule((()=>c.searchFeatures(o(E.toJSON()))),d),w,c);await c.reschedule((()=>c.executeObjectIdsQuery(F)),d),await c.reschedule((()=>c.executeTimeQuery(F)),d),await c.reschedule((()=>c.executeAttributesQuery(F)),d),await c.reschedule((()=>f(c,F,d)),d);const T=q.toJSON(),v=h?n(T,c.spatialReference):T,I=h?Math.max(U.xmax-U.xmin,U.ymax-U.ymin)/2:g;return F.createSnappingResponse({...u,point:v,distance:I},w.returnZ,x.spatialReference)}async function f(e,t,r){const{query:a}=t,{spatialRel:i}=a;if(!t?.items?.length||!a.geometry||!i)return;const s=await c(i,a.geometry,e.geometryType,e.hasZ,e.hasM),n=await e.runSpatialFilter(t.items,(e=>s(e.geometry)),r);t.items=n}export{u as executeQueryForSnapping};\n"],"names":["u","c","y","d","t","x","g","R","j","w","e","p","m","h","i","s","b","Q","S","U","n","q","a","r","E","F","l","o","f","T","v","I","_a"],"mappings":"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","x_google_ignoreList":[0]}