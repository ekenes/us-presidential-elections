{"version":3,"file":"GridSnappingEngine-BhZPWRSf.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/GridSnappingEngine.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as t}from\"tslib\";import e from\"../../../core/Accessor.js\";import r from\"../../../core/Logger.js\";import{deg2rad as i}from\"../../../core/mathUtils.js\";import{convertUnit as n}from\"../../../core/unitUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{K as a}from\"../../../chunks/vec32.js\";import{isLoadedOrLoadFor as p,project as l}from\"../../../geometry/projectionUtils.js\";import{getClosestDenormalizedXToReference as c}from\"../../../geometry/support/normalizeUtils.js\";import{getResolutionForScale as u}from\"../../../geometry/support/scaleUtils.js\";import{minimumPixelsPerStrideForDisplayWhenScalingOff as d}from\"../../2d/grid/constants.js\";import{getScaleFactor as g,measureMetersPerUnitAtReferencePoint as f}from\"../../2d/grid/gridUtils.js\";import{create as h,createWritable as m}from\"../sketch/normalizedPoint.js\";import{gridPlacementGraphicSymbol as S}from\"./snappingUtils.js\";import{IntersectionSnappingCandidate as y}from\"./candidates/IntersectionSnappingCandidate.js\";import{LineSnappingCandidate as v}from\"./candidates/LineSnappingCandidate.js\";let w=class extends e{constructor(t){super(t),this.options=null}destroy(){this._set(\"options\",null)}get grid(){return this.view.grid}get effectiveViewRotation(){return this.grid?.rotateWithMap?0:i(this.view.rotation??0)}get gridRotation(){return i(this.grid?.rotation??0)}get gridCenter(){const{spatialReference:t,grid:e}=this;if(!e||!t||!p(e.center.spatialReference,t))return null;try{const r=l(e.center,t),i=t.isWrappable&&null!=this.view?.center?c(r.x,this.view.center.x,t):r.x;return h(i,r.y,r.z)}catch(i){return r.getLogger(this).errorOnce(\"Grid Snapping - Failed to project grid center.\",i),null}}get offsetScaleFactor(){const{pixelsPerStride:t,grid:e}=this;if(!e||!t)return 1;const{majorLineInterval:r,dynamicScaling:i}=e;return r<1?null:g(r,t,i)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){const{grid:t}=this;return t?n(t.spacing,t.units,\"meters\"):null}get viewMetersPerPixel(){const{viewMetersPerSRUnit:t}=this;return null==t?null:t*u(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){const{spatialReference:t}=this.view;return this.gridCenter?f(this.gridCenter[0],this.gridCenter[1],t):null}get pixelsPerStride(){const{gridMetersPerStride:t,viewMetersPerPixel:e}=this;return e&&t?t/e:null}get updating(){return null!=this.grid&&null!=this.spatialReference&&null==this.viewMetersPerSRUnit}async fetchCandidates(t,e,r){const{options:i,view:n}=this;if(!i?.effectiveGridEnabled||!n.grid||r.feature?.attributes&&S in r.feature.attributes)return[];const o=r.coordinateHelper.arrayToPoint(t),s=i.distance*(\"touch\"===r.pointer?i.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(o,s)}fetchCandidatesSync(t,e){const r=[],{grid:i,effectiveViewRotation:n,gridRotation:o,gridCenter:s,viewMetersPerPixel:a,viewMetersPerSRUnit:c,offsetScaleFactor:u,spatialReference:g,gridMetersPerStride:f,pixelsPerStride:m}=this;if(!(i&&a&&c&&s&&g&&u&&f&&m))return r;if(!i.dynamicScaling&&m<d)return r;if(!p(t.spatialReference,g))return r;const S=l(t,g),w=h(S.x,S.y,S.z),x=P(w,-o,s,-n),C=f/c*u,U=R(x,C,s),{shouldSnapX:b,shouldSnapY:L}=j(U,x,e,a,c);if(!b&&!L)return[];const z=h((b?U:x)[0],(L?U:x)[1]),E=P(z,o,s,n),F=P(U,o,s,n);if(L){const t=M(U,x,C,\"y\"),e=P(t,o,s,n);r.push(new v({lineStart:F,lineEnd:e,targetPoint:E,isDraped:!1}))}if(b){const t=M(U,x,C,\"x\"),e=P(t,o,s,n);r.push(new v({lineStart:F,lineEnd:e,targetPoint:E,isDraped:!1}))}return b&&L&&r.push(new y(E,r[0],r[1],!1)),r}};t([o({constructOnly:!0})],w.prototype,\"view\",void 0),t([o()],w.prototype,\"options\",void 0),t([o()],w.prototype,\"grid\",null),t([o()],w.prototype,\"effectiveViewRotation\",null),t([o()],w.prototype,\"gridRotation\",null),t([o()],w.prototype,\"gridCenter\",null),t([o()],w.prototype,\"offsetScaleFactor\",null),t([o()],w.prototype,\"spatialReference\",null),t([o()],w.prototype,\"gridMetersPerStride\",null),t([o()],w.prototype,\"viewMetersPerPixel\",null),t([o()],w.prototype,\"viewMetersPerSRUnit\",null),t([o()],w.prototype,\"pixelsPerStride\",null),t([o()],w.prototype,\"updating\",null),w=t([s(\"esri.views.interactive.snapping.GridSnappingEngine\")],w);const P=(t,e,r,i)=>{const n=m(t[0],t[1],t[2]);return a(n,a(n,n,r,e),r,i)},R=(t,e,r)=>{const i=(t[0]-r[0])/e,n=(t[1]-r[1])/e,o=Math.trunc(i),s=Math.trunc(n),a=Math.round(i%1),p=Math.round(n%1),l=r[0]+(o+a)*e,c=r[1]+(s+p)*e;return h(l,c)},j=(t,e,r,i,n)=>{if(i<=0)return{shouldSnapX:!1,shouldSnapY:!1};const o=(t[0]-e[0])/i,s=(t[1]-e[1])/i;return{shouldSnapX:Math.abs(o*n)<r,shouldSnapY:Math.abs(s*n)<r}},M=(t,e,r,i)=>{if(\"y\"===i){const i=e[0]>t[0]?1:-1;return h(t[0]+r*i,t[1])}const n=e[1]>t[1]?1:-1;return h(t[0],t[1]+r*n)};export{w as GridSnappingEngine};\n"],"names":["w","e","t","_a","i","p","l","c","h","r","g","n","u","f","S","o","s","a","m","d","x","P","C","U","R","b","L","j","z","E","F","M","v","y"],"mappings":"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","x_google_ignoreList":[0]}