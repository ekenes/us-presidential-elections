{"version":3,"file":"densifyCurvedGeometry-BRu1jhE-.js","sources":["../../node_modules/@arcgis/core/geometry/support/curves/densifyCurvedGeometry.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{interpolateCubicBezier as t}from\"./bezierCurveUtils.js\";import{deriveCircleFromCircularArc as s}from\"./circularArcUtils.js\";import{isCurvedGeometry as i,getCurves as n,getEndpoint as e,isCoordinate as r,isBezierCurve as a,isCircularArc as h,isEllipticArc4 as c,isEllipticArc7 as o,cloneCurve as u}from\"./curveUtils.js\";import{deriveCircleFromEllipticArc4 as p}from\"./ellipticArc4Utils.js\";import{deriveEllipse as l,interpolateEllipse as d}from\"./ellipticArc7Utils.js\";import{interpolateSegment as m,pointToSegmentDistance2 as S,distance2 as E}from\"./mathUtils.js\";const v={maxSegmentLength:1/0,maxDeviation:1/0,maxSegmentsPerCurve:12e3,minSegmentsPerCurve:1},f=1e-6,g=[0,0];function M(t){return{maxSegmentLength:t.maxSegmentLength??v.maxSegmentLength,maxDeviation:t.maxDeviation??v.maxDeviation,maxSegmentsPerCurve:t.maxSegmentsPerCurve??v.maxSegmentsPerCurve,minSegmentsPerCurve:Math.max(t.minSegmentsPerCurve??v.minSegmentsPerCurve,1)}}class P{constructor(t,s){this.curveStart=t,this.curveEnd=s,this.tStart=0,this.tEnd=0,this.tEndStack=[],this.arcEndStack=[]}get stackSize(){return this.tEndStack.length}initialize(t,s){this.tStart=0,this.arcStart=t,this.tEndStack.push(1),this.arcEndStack.push(s)}splitAt(t){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(t),this.arcEndStack.push(this.interpolate(t))}splitInHalf(){return this.splitAt((this.tStart+this.tEnd)/2)}pop(){this.tEnd=this.tEndStack.pop(),this.arcEnd=this.arcEndStack.pop()}next(){this.tStart=this.tEnd,this.arcStart=this.arcEnd}densify(t,{maxDeviation:s,maxSegmentLength:i,maxSegmentsPerCurve:n,minSegmentsPerCurve:e}){const r=i*i,a=s*s,h=1/n,c=this.interpolate(0),o=this.interpolate(1);E(this.curveStart,c)>f&&t.push(c),this.initialize(c,o);const u=1/e;for(let p=e-1;p>0;p--){const t=p*u;this.pop(),this.splitAt(t)}for(;this.stackSize>0;)this.pop(),this.tStart===this.tEnd||this.tEnd-this.tStart<h||(0===r||!isFinite(r)||E(this.arcStart,this.arcEnd)<r)&&(0===a||!isFinite(a)||this.getDeviation2()<a)?(t.push(this.arcEnd),this.next()):this.splitInHalf();return E(this.curveEnd,o)>f&&t.push([...this.curveEnd]),t}}class x extends P{constructor(t,s){const[i,n,e]=s.b;super(t,i),this._controlPointsStack=[],this._curveControlPoints=[n,e],this._arcControlPoints=[n,e],this._controlPointsStack.push(this._arcControlPoints)}splitAt(t){const{arcStart:s,arcEnd:i,tStart:n,tEnd:e}=this,[r,a]=this._arcControlPoints,h=(t-n)/(e-n),c=m([],s,r,h),o=m(g,r,a,h),u=m([],a,i,h),p=m([],c,o,h),l=m([],o,u,h),d=m([],p,l,h);this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this._controlPointsStack.push([l,u]),this.tEndStack.push(t),this.arcEndStack.push(d),this._arcControlPoints[0]=c,this._arcControlPoints[1]=p,this._controlPointsStack.push(this._arcControlPoints)}pop(){super.pop(),this._arcControlPoints=this._controlPointsStack.pop()}interpolate(s){const{curveStart:i,curveEnd:n}=this,[e,r]=this._curveControlPoints;return t(i,e,r,n,s)}getDeviation2(){const{arcStart:t,arcEnd:s}=this,[i,n]=this._arcControlPoints;return Math.max(S(i,t,s),S(n,t,s))}}class k extends P{constructor(t,s){const[i]=s.a;super(t,i),this._derivedEllipse=l(t,s)}pop(){super.pop(),this._tMid=(this.tStart+this.tEnd)/2,this._arcMid=this.interpolate(this._tMid)}splitInHalf(){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(this._tMid),this.arcEndStack.push(this._arcMid)}interpolate(t){return d(this._derivedEllipse,t)}getDeviation2(){return S(this._arcMid,this.arcStart,this.arcEnd)}}function C(t,s,i,{cx:n,cy:e,radius:r,thetaStart:a,thetaEnd:h,isInvalid:c},{maxDeviation:o,maxSegmentLength:u,maxSegmentsPerCurve:p,minSegmentsPerCurve:l}){if(c)return t.push([...i]),t;const d=2*r,m=[n+r*Math.cos(a),e+r*Math.sin(a)],S=[n+r*Math.cos(h),e+r*Math.sin(h)];E(s,m)>f&&t.push(m);const v=Math.abs(h-a),g=u<d?2*Math.asin(u/d):v,M=o<=r?2*Math.acos(1-o/r):v,P=Math.min(g,M),x=Math.min(p,Math.max(l,Math.ceil(Math.abs(v/P)))),k=1/x;for(let E=1;E<x;E++){const s=E*k,i=a*(1-s)+h*s;t.push([n+r*Math.cos(i),e+r*Math.sin(i)])}return t.push(S),E(i,S)>f&&t.push([...i]),t}function _(t,s,i,n){return new x(s,i).densify(t,n)}function Z(t,i,n,e){const r=s(i,n),[a]=n.c;return C(t,i,a,r,e)}function A(t,s,i,n){const e=p(s,i),[r]=i.a;return C(t,s,r,e,n)}function D(t,s,i,n){const[e,r,a,h,c,o,u]=i.a;return 0===o||0===u?(t.push([...e]),t):new k(s,i).densify(t,n)}function R(t,s,i,n){return r(i)?(t.push([...i]),t):a(i)?_(t,s,i,n):h(i)?Z(t,s,i,n):c(i)?A(t,s,i,n):D(t,s,i,n)}function y(t,s){if(!i(t))return t;const r=M(s),a=n(t),h=[];for(const i of a){const t=[];for(let s=0;s<i.length-1;s++){const n=s+1,a=[...e(i[s])];0===s&&t.push(a);R(t,a,i[n],r)}h.push(t)}return\"curvePaths\"in t?{...void 0!==t.hasZ?{hasZ:t.hasZ}:{},...void 0!==t.hasM?{hasM:t.hasM}:{},paths:h,spatialReference:t.spatialReference}:{...void 0!==t.hasZ?{hasZ:t.hasZ}:{},...void 0!==t.hasM?{hasM:t.hasM}:{},rings:h,spatialReference:t.spatialReference}}function j(t,s,p){if(!i(t))return t;const l=new Set(s),d=M(p),m=n(t),S=[];let E=!1;for(const i of m){const t=[];for(let s=0;s<i.length-1;s++){const n=s+1,p=[...e(i[s])];0===s&&t.push(p);const m=i[n];r(m)?t.push([...m]):a(m)&&!l.has(\"esriGeometryBezier3Curve\")?_(t,p,m,d):h(m)&&!l.has(\"esriGeometryCircularArc\")?Z(t,p,m,d):c(m)&&!l.has(\"esriGeometryEllipticArc\")?A(t,p,m,d):o(m)&&!l.has(\"esriGeometryEllipticArc\")?D(t,p,m,d):(t.push(u(m)),E=!0)}S.push(t)}return\"curvePaths\"in t?{...void 0!==t.hasZ?{hasZ:t.hasZ}:{},...void 0!==t.hasM?{hasM:t.hasM}:{},spatialReference:t.spatialReference,...E?{curvePaths:S}:{paths:S}}:{hasZ:t.hasZ,hasM:t.hasM,spatialReference:t.spatialReference,...E?{curveRings:S}:{rings:S}}}export{y as densifyCurvedGeometry,j as selectiveDensifyCurvedGeometry};\n"],"names":["f","g","M","P","t","s","n","e","r","a","h","o","E","u","x","m","l","d","i","S","k","C","c","p","v","_","Z","A","D","R","y"],"mappings":"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","x_google_ignoreList":[0]}