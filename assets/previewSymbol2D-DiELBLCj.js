import{c2 as H,c3 as I,c4 as A,c5 as D,a8 as b,c6 as J,c7 as K,a as Q,c8 as Z,c9 as V,bu as T,ca as X,cb as Y,cc as _,cd as tt,ce as P}from"./index-Wrx4-yWN.js";import{y as q}from"./densifyCurvedGeometry-Z01KJqKs.js";const W="picture-fill",at="picture-marker",nt="simple-fill",ot="simple-line",it="simple-marker",et="text",lt="Aa",st=22,L=120,rt=80,R=50,U=225,ht=document.createElement("canvas");function N(a,t,s){const{extent:o}=a;if(!o)return"";const p=o.width||1,h=o.height||1;if(a.type==="polygon"){const r=a.clone();T(r)&&(r.rings=q(r,{minSegmentsPerCurve:128}).rings),X({originPosition:"upperLeft",scale:[p/t,h/s],translate:[o.xmin,o.ymax]},r,r);let e="";for(let l=0;l<r.rings.length;l++){const u=r.rings[l];for(let c=0;c<u.length;c++){const f=u[c][0],i=u[c][1],n=c===0?"M":"l",x=c===u.length-1?" Z":"";e+=`${e!==""?" ":""}${n}${f.toString()} ${i.toString()}${x}`}}return e}if(a.type==="polyline"){const r=a.clone();T(r)&&(r.paths=q(r,{minSegmentsPerCurve:128}).paths),Y({originPosition:"upperLeft",scale:[p/t,h/s],translate:[o.xmin,o.ymax]},r,r);let e="";for(let l=0;l<r.paths.length;l++){const u=r.paths[l];for(let c=0;c<u.length;c++){const f=u[c][0],i=u[c][1];e+=`${e!==""?" ":""}${c===0?"M":"l"}${f.toString()} ${i.toString()}`}}return e}return""}function G(a,t){const s=ht.getContext("2d"),o=[];t&&(t.weight&&o.push(t.weight),t.size&&o.push(t.size+"px"),t.family&&o.push(t.family)),s.font=o.join(" ");const{width:p,actualBoundingBoxLeft:h,actualBoundingBoxRight:r,actualBoundingBoxAscent:e,actualBoundingBoxDescent:l}=s.measureText(a);return{width:Math.ceil(Math.max(p,h+r)),height:Math.ceil(e+l),x:Math.floor(h),y:Math.floor((e-l)/2)}}function S(a){const t=a==null?void 0:a.size;return{width:t!=null&&typeof t=="object"&&"width"in t?b(t.width):null,height:t!=null&&typeof t=="object"&&"height"in t?b(t.height):null}}async function ct(a,t){const s=t.fill,o=a.color;if((s==null?void 0:s.type)==="pattern"&&o&&a.type!==W){const p=await _(s.src,o.toCss(!0));s.src=p,t.fill=s}}async function ut(a,t,s,o){var r,e,l;if(!("font"in a)||!a.font||t.shape.type!=="text")return;try{await tt(a.font)}catch{}const{width:p,height:h}=S(o);if(!/[\uE600-\uE6FF]/.test(t.shape.text)){const{width:u,height:c,x:f,y:i}=G(t.shape.text,{weight:(r=t.font)==null?void 0:r.weight,size:(e=t.font)==null?void 0:e.size,family:(l=t.font)==null?void 0:l.family});s[0]=p??u,s[1]=h??c,t.shape.x=f,t.shape.y=i;let n="angle"in a?a.angle:null;if((o==null?void 0:o.rotation)!=null&&(n=(n??0)+o.rotation),n){const x=n*(Math.PI/180),z=Math.abs(Math.sin(x)),C=Math.abs(Math.cos(x));s[1]=s[0]*z+s[1]*C}}}function mt(a,t,s,o,p){var h;if(a.haloColor!=null&&a.haloSize!=null){p.masking??(p.masking=s.map(()=>[]));const r=b(a.haloSize);o[0]+=r,o[1]+=r,s.unshift([{...t,fill:null,stroke:{color:a.haloColor,width:2*r,join:"round",cap:"round"}}]),p.masking.unshift([{shape:{type:"rect",x:0,y:0,width:o[0]+2*P,height:o[1]+2*P},fill:[255,255,255],stroke:null},{...t,fill:[0,0,0,0],stroke:null}])}a.backgroundColor==null&&a.borderLineColor==null||(o[0]+=2*P,o[1]+=2*P,s.unshift([{shape:{type:"rect",x:0,y:0,width:o[0],height:o[1]},fill:a.backgroundColor,stroke:{color:a.borderLineColor,width:b(a.borderLineSize)}}]),(h=p.masking)==null||h.unshift([]))}function O(a,t){return a>t?"dark":"light"}function pt(a,t){var z,C,E,$,j;const s=typeof(t==null?void 0:t.size)=="number"?t==null?void 0:t.size:null,o=s!=null?b(s):null,p=(t==null?void 0:t.maxSize)!=null?b(t.maxSize):null;let h="angle"in a?a.angle:null;(t==null?void 0:t.rotation)!=null&&(h=(h??0)+t.rotation);const r=H(a);let e=I(a);dt(a,245)!=="dark"||t!=null&&t.ignoreWhiteSymbols||(e={width:.75,...e,color:"#bdc3c7"});let l=null;const u={shape:null,fill:r,stroke:e,offset:[0,0]};e!=null&&e.width&&(e.width=Math.min(e.width,rt));const c=(e==null?void 0:e.width)||0;let f=(t==null?void 0:t.size)!=null&&((t==null?void 0:t.scale)==null||(t==null?void 0:t.scale)),i=0,n=0,x=!1;switch(a.type){case it:{const g=a.style,{width:d,height:m}=S(t);let v=d===m&&d!=null?d:o??Math.min(b(a.size),p||L);if((t==null?void 0:t.useMarkerSymbolSize)===!0&&d!==null&&m!==null){const y=Math.min(b(a.size),p||L);v=y>d&&y>m?Math.min(d,m):y}switch(i=v,n=v,g){case"circle":u.shape={type:"circle",cx:0,cy:0,r:.5*v},f||(i+=c,n+=c);break;case"cross":u.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[i,.5*n]},{command:"M",values:[.5*i,0]},{command:"L",values:[.5*i,n]}]};break;case"diamond":u.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[.5*i,0]},{command:"L",values:[i,.5*n]},{command:"L",values:[.5*i,n]},{command:"Z",values:[]}]},f||(i+=c,n+=c);break;case"square":u.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,0]},{command:"L",values:[i,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},f||(i+=c,n+=c),h&&(x=!0);break;case"triangle":u.shape={type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},f||(i+=c,n+=c),h&&(x=!0);break;case"x":u.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,n]},{command:"M",values:[i,0]},{command:"L",values:[0,n]}]},h&&(x=!0);break;case"path":u.shape={type:"path",path:a.path||""},f||(i+=c,n+=c),h&&(x=!0),f=!0}break}case ot:{const{width:g,height:d}=S(t),m=K(e).reduce((M,k)=>M+k,0),v=m&&Math.ceil(R/m),y=d??o??c,w=g??(m*v||R);if(f=!0,((z=t==null?void 0:t.geometry)==null?void 0:z.type)==="polyline"&&((C=t==null?void 0:t.geometry)==null?void 0:C.extent)){i=w,n=d??i;const M=1e3,k=.15*M;l=[i,n],n=l[0]>l[1]?M*l[1]/l[0]:M,i=l[0]>l[1]?M:M*l[0]/l[1],e!=null&&e.width&&(e.width=e.width*M/(l[1]>l[0]?l[1]:l[0]),e.width>k&&(e.width=k)),u.shape={type:"path",path:N(t.geometry,i,n)}}else i=(t==null?void 0:t.maxSize)!=null?Math.min(w,t.maxSize):w,n=y,e&&(e.width=y),u.shape={type:"path",path:[{command:"M",values:[y/2,n/2]},{command:"L",values:[i-y/2,n/2]}]};break}case W:case nt:{const g=typeof(t==null?void 0:t.symbolConfig)=="object"&&!!((E=t==null?void 0:t.symbolConfig)!=null&&E.isSquareFill),{width:d,height:m}=S(t);i=!g&&d!==m||d==null?o??st:d,n=!g&&d!==m||m==null?i:m,f||(i+=c,n+=c),f=!0,($=t==null?void 0:t.geometry)!=null&&$.extent&&((j=t==null?void 0:t.geometry)==null?void 0:j.type)==="polygon"?(l=[i,n],n=l[0]>l[1]?1e3*l[1]/l[0]:1e3,i=l[0]>l[1]?1e3:1e3*l[0]/l[1],u.shape={type:"path",path:N(t.geometry,i,n)}):u.shape=g?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,0]},{command:"L",values:[i,n]},{command:"L",values:[0,n]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:J.fill[0];break}case at:{const g=Math.min(b(a.width),p||L),d=Math.min(b(a.height),p||L),{width:m,height:v}=S(t),y=m===v&&m!=null?m:o??Math.max(g,d),w=a.width/a.height;i=w<=1?Math.ceil(y*w):y,n=w<=1?y:Math.ceil(y/w),u.shape={type:"image",x:-Math.round(i/2),y:-Math.round(n/2),width:i,height:n,src:a.url||""},h&&(x=!0);break}case et:{const g=a,d=(t==null?void 0:t.overrideText)||g.text||lt,m=g.font,{width:v,height:y}=S(t),w=y??o??Math.min(b(m.size),p||L),{width:M,height:k}=G(d,{weight:m.weight,size:w,family:m.family}),B=/[\uE600-\uE6FF]/.test(d);i=v??(B?w:M),n=B?w:k;let F=.5*(B?w:k);B&&(F+=5),u.shape={type:"text",text:d,x:g.xoffset||0,y:g.yoffset||F,align:"middle",alignBaseline:g.verticalAlignment,decoration:m&&m.decoration,rotated:g.rotated,kerning:g.kerning},u.font=m&&{size:w,style:m.style,decoration:m.decoration,weight:m.weight,family:m.family};break}}return{shapeDescriptor:u,size:[i,n],outputSize:l,renderOptions:{node:t==null?void 0:t.node,scale:f,opacity:t==null?void 0:t.opacity,rotations:[h],useRotationSize:x,cssEffectFilter:t==null?void 0:t.cssEffectFilter,ariaLabel:t==null?void 0:t.ariaLabel,clipBloomEffect:t==null?void 0:t.clipBloomEffect}}}async function yt(a,t){var l,u,c,f,i;const{shapeDescriptor:s,size:o,renderOptions:p,outputSize:h}=pt(a,t);if(!s.shape)throw new Q("symbolPreview: renderPreviewHTML2D","symbol not supported.");await ct(a,s),await ut(a,s,o,t);const r=[[s]];if(typeof(t==null?void 0:t.symbolConfig)=="object"&&((l=t==null?void 0:t.symbolConfig)!=null&&l.applyColorModulation)){const n=.6*o[0];r.unshift([{...s,offset:[-n,0],fill:Z(s.fill,-.3)}]),r.push([{...s,offset:[n,0],fill:Z(s.fill,.3)}]),o[0]+=2*n,p.scale=!1}a.type==="text"&&mt(a,s,r,o,p);const e=V(r,o,p);if(h&&e){const n=e.nodeName.toLowerCase()==="img"?e:e.firstChild;n.nodeName.toLowerCase()==="svg"&&n.setAttribute("viewBox",`0 0 ${o[0].toString()} ${o[1].toString()}`),n.setAttribute("width",h[0].toString()),n.setAttribute("height",h[1].toString()),h.length>2&&(n.style.setProperty("padding-left",((u=h[2])==null?void 0:u.toString())+"px"),n.style.setProperty("padding-right",((c=h[2])==null?void 0:c.toString())+"px"),n.style.setProperty("padding-top",((f=h[3])==null?void 0:f.toString())+"px"),n.style.setProperty("padding-bottom",((i=h[3])==null?void 0:i.toString())+"px"),n.style.setProperty("box-sizing","border-box"))}return e}function dt(a,t=U){const s=H(a),o=I(a),p=!s||"type"in s?null:new A(s),h=o!=null&&o.color?new A(o==null?void 0:o.color):null,r=p?O(D(p),t):null,e=h?O(D(h),t):null;return e?r?r===e?r:t>=U?"light":"dark":e:r}export{dt as getContrastingBackgroundTheme,pt as getRenderSymbolParameters,yt as previewSymbol2D};
//# sourceMappingURL=previewSymbol2D-DiELBLCj.js.map
