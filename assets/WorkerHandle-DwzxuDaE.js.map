{"version":3,"file":"WorkerHandle-DwzxuDaE.js","sources":["../../node_modules/@arcgis/core/core/workers/WorkerHandle.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{remove as e}from\"../arrayUtils.js\";import{makeHandle as t}from\"../handleUtils.js\";import s from\"../Logger.js\";import{throwIfAborted as r}from\"../promiseUtils.js\";import{open as i}from\"./workers.js\";class h{constructor(e,t,r,h,o={}){this._mainMethod=t,this._transferLists=r,this._listeners=[],this._promise=i(e,{...o,schedule:h}).then((e=>{if(void 0===this._thread){this._thread=e,this._promise=null,o.hasInitialize&&this.broadcast({},\"initialize\");for(const e of this._listeners)this._connectListener(e)}else e.close()})),this._promise.catch((t=>s.getLogger(\"esri.core.workers.WorkerHandle\").error(`Failed to initialize ${e} worker: ${t}`)))}on(s,r){const i={removed:!1,eventName:s,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),t((()=>{i.removed=!0,e(this._listeners,i),this._thread&&null!=i.threadHandle&&i.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t,s){return this.invokeMethod(this._mainMethod,e,t,s)}invokeMethod(e,t,s,i){if(this._thread){const r=this._transferLists[e],h=r?r(t):[];return this._thread.invoke(e,t,{transferList:h,signal:s,priority:i})}return this._promise?this._promise.then((()=>(r(s),this.invokeMethod(e,t,s)))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then((t=>{e.removed||(e.threadHandle=t)}))}}export{h as WorkerHandle};\n"],"names":["r","o","i","e","t","s","h"],"mappings":"+EAI6M,KAAO,CAAC,YAAY,EAAE,EAAEA,EAAE,EAAEC,EAAE,CAAA,EAAG,CAAC,KAAK,YAAY,EAAE,KAAK,eAAeD,EAAE,KAAK,WAAW,CAAA,EAAG,KAAK,SAASE,EAAE,EAAE,CAAC,GAAGD,EAAE,SAAS,CAAC,CAAC,EAAE,MAAME,GAAG,CAAC,GAAY,KAAK,UAAd,OAAsB,CAAC,KAAK,QAAQA,EAAE,KAAK,SAAS,KAAKF,EAAE,eAAe,KAAK,UAAU,CAAA,EAAG,YAAY,EAAE,UAAUE,KAAK,KAAK,WAAW,KAAK,iBAAiBA,CAAC,CAAC,MAAMA,EAAE,MAAK,CAAE,EAAC,EAAG,KAAK,SAAS,OAAOC,GAAGC,EAAE,UAAU,gCAAgC,EAAE,MAAM,wBAAwB,CAAC,YAAYD,CAAC,EAAE,EAAC,CAAE,CAAC,GAAGC,EAAEL,EAAE,CAAC,MAAME,EAAE,CAAC,QAAQ,GAAG,UAAUG,EAAE,SAASL,EAAE,aAAa,IAAI,EAAE,OAAO,KAAK,WAAW,KAAKE,CAAC,EAAE,KAAK,iBAAiBA,CAAC,EAAEE,GAAG,IAAI,CAACF,EAAE,QAAQ,GAAGC,EAAE,KAAK,WAAWD,CAAC,EAAE,KAAK,SAAeA,EAAE,cAAR,MAAsBA,EAAE,aAAa,OAAM,CAAE,EAAC,CAAE,CAAC,SAAS,CAAC,KAAK,UAAU,KAAK,QAAQ,MAAK,EAAG,KAAK,QAAQ,MAAM,KAAK,SAAS,KAAK,KAAK,WAAW,OAAO,EAAE,KAAK,eAAe,CAAA,CAAE,CAAC,OAAO,EAAE,EAAE,EAAE,CAAC,OAAO,KAAK,aAAa,KAAK,YAAY,EAAE,EAAE,CAAC,CAAC,CAAC,aAAa,EAAE,EAAE,EAAEA,EAAE,CAAC,GAAG,KAAK,QAAQ,CAAC,MAAM,EAAE,KAAK,eAAe,CAAC,EAAEI,EAAE,EAAE,EAAE,CAAC,EAAE,CAAA,EAAG,OAAO,KAAK,QAAQ,OAAO,EAAE,EAAE,CAAC,aAAaA,EAAE,OAAO,EAAE,SAASJ,CAAC,CAAC,CAAC,CAAC,OAAO,KAAK,SAAS,KAAK,SAAS,MAAM,KAAKF,EAAE,CAAC,EAAE,KAAK,aAAa,EAAE,EAAE,CAAC,GAAE,EAAG,QAAQ,OAAO,IAAI,CAAC,CAAC,UAAU,EAAE,EAAE,CAAC,OAAO,KAAK,QAAQ,QAAQ,IAAI,KAAK,QAAQ,UAAU,EAAE,CAAC,CAAC,EAAE,MAAM,IAAI,CAAC,EAAC,EAAG,KAAK,SAAS,KAAK,SAAS,MAAM,IAAI,KAAK,UAAU,EAAE,CAAC,EAAC,EAAG,QAAQ,OAAM,CAAE,CAAC,IAAI,SAAS,CAAC,OAAO,KAAK,QAAQ,CAAC,iBAAiB,EAAE,CAAC,KAAK,SAAS,KAAK,QAAQ,GAAG,EAAE,UAAU,EAAE,QAAQ,EAAE,MAAM,GAAG,CAAC,EAAE,UAAU,EAAE,aAAa,EAAE,EAAC,CAAE,CAAC","x_google_ignoreList":[0]}