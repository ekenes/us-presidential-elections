{"version":3,"file":"applyEditsUtils-KlFZwLD4.js","sources":["../../node_modules/@arcgis/core/layers/graphics/applyEditsUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport e from\"../../Graphic.js\";import t from\"../../core/Error.js\";import r from\"../../core/Logger.js\";import{getMetersPerCartesianUnitForSR as a}from\"../../core/unitUtils.js\";import{parseData as s}from\"../../core/urlUtils.js\";import{isEqualBaseGCS as o,canProjectWithoutEngine as n,projectWithoutEngine as l}from\"../../geometry/projectionUtils.js\";import{fromJSON as i}from\"../../geometry/support/jsonUtils.js\";import u from\"../../geometry/support/MeshTransform.js\";import{equals as d}from\"../../geometry/support/spatialReferenceUtils.js\";import{isFeatureIdentifierArrayWithGlobalId as c,isFeatureIdentifierArrayWithObjectId as p}from\"./editingSupport.js\";async function m(e,t,r){const{geometry:s}=t,i={...t.attributes};if(null!=r&&\"mesh\"===s?.type){const{transformFieldRoles:t}=r,{origin:c,spatialReference:p,vertexSpace:m}=s,f=s.transform??new u,g=\"local\"===m.type,b=e.spatialReference,y=b.isGeographic,R=d(b,p),h=o(p,b)&&n(p,b);if(!(g&&y&&h||!g&&!y&&R))return null;const I=l(c,p,b);if(null==I)return null;if(i[t.originX]=I.x,i[t.originY]=I.y,i[t.originZ]=I.z??0,null!=f){const{translation:e,scale:r,rotation:s}=f,o=g?1:a(p)/a(b);i[t.translationX]=e[0]*o,i[t.translationY]=e[2]*o,i[t.translationZ]=-e[1]*o,i[t.scaleX]=r[0],i[t.scaleY]=r[2],i[t.scaleZ]=r[1],i[t.rotationX]=s[0],i[t.rotationY]=s[2],i[t.rotationZ]=-s[1],i[t.rotationDeg]=s[3]}return{attributes:i}}return null==s?{attributes:i}:\"mesh\"===s.type||\"extent\"===s.type?null:{geometry:s.toJSON(),attributes:i}}async function f(e,t){const r=await Promise.all((t.addAttachments??[]).map(t=>g(e,t))),a=await Promise.all((t.updateAttachments??[]).map(t=>g(e,t))),s=t.deleteAttachments??[];return r.length||a.length||s.length?{adds:r,updates:a,deletes:[...s]}:null}async function g(e,t){const{feature:r,attachment:a}=t,{globalId:o,name:n,contentType:l,data:i,uploadId:u}=a,d={globalId:o};if(r&&(\"attributes\"in r?d.parentGlobalId=r.attributes?.[e.globalIdField]:r.globalId&&(d.parentGlobalId=r.globalId)),u)d.uploadId=u;else if(i){const e=await s(i);e&&(d.contentType=e.mediaType,d.data=e.data),i instanceof File&&(d.name=i.name)}return n&&(d.name=n),l&&(d.contentType=l),d}function b(e,t,r){if(!t||0===t.length)return[];if(r&&c(t))return t.map(e=>e.globalId);if(p(t))return t.map(e=>e.objectId);const a=r?e.globalIdField:e.objectIdField;return a?t.map(e=>e.getAttribute(a)):[]}function y(e){const t=e?.assetMaps;if(t){for(const e of t.addResults)e.success||r.getLogger(\"esri.layers.graphics.sources.support.sourceUtils\").error(`Failed to map asset to feature with globalId ${e.globalId}.`);for(const e of t.updateResults)e.success||r.getLogger(\"esri.layers.graphics.sources.support.sourceUtils\").error(`Failed to map asset to feature with globalId ${e.globalId}.`)}const a=e?.attachments,s={addFeatureResults:e?.addResults?.map(R)??[],updateFeatureResults:e?.updateResults?.map(R)??[],deleteFeatureResults:e?.deleteResults?.map(R)??[],addAttachmentResults:a?.addResults?a.addResults.map(R):[],updateAttachmentResults:a?.updateResults?a.updateResults.map(R):[],deleteAttachmentResults:a?.deleteResults?a.deleteResults.map(R):[]};return e?.editMoment&&(s.editMoment=e.editMoment),s}function R(e){const r=!0===e.success?null:e.error||{code:void 0,description:\"Feature edit failed\"};return{objectId:e.objectId,globalId:e.globalId,error:r?new t(\"feature-layer-source:edit-failure\",r.description,{code:r.code}):null}}function h(t,r){return new e({attributes:t.attributes,geometry:i({...t.geometry,spatialReference:r})})}function I(e,t){return{adds:e?.adds?.map(e=>h(e,t))||[],updates:e?.updates?.map(e=>({original:h(e[0],t),current:h(e[1],t)}))||[],deletes:e?.deletes?.map(e=>h(e,t))||[],spatialReference:t}}function j(e){const t=e.details.raw,r=+t.code,a=+t.extendedCode;return 500===r&&(-2147217144===a||-2147467261===a)}export{I as createEditedFeatures,R as createFeatureEditResult,f as getAttachmentEditsJSON,b as getFeatureIds,m as getFeatureJSON,j as isProtectedOrPrivateVersionError,y as unpackEditResultData};\n"],"names":["m","e","t","r","s","i","c","p","f","u","g","b","y","R","d","h","o","n","I","l","a","_a","_b","_c","j"],"mappings":"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","x_google_ignoreList":[0]}