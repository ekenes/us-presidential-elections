{"version":3,"file":"FeatureCollectionSnappingSource-C30L76pm.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/FeatureCollectionSnappingSource.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import{memoize as i}from\"../../../../core/memoize.js\";import{throwIfAborted as r,whenOrAbort as n}from\"../../../../core/promiseUtils.js\";import{watch as o,on as a,initial as s}from\"../../../../core/reactiveUtils.js\";import{sqlAnd as l}from\"../../../../core/sql.js\";import{property as p}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import\"../../../../core/RandomLCG.js\";import{subclass as y}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{elevationContextAffectsAlignment as c}from\"../../../../support/elevationInfoUtils.js\";import{makeSnappingQuery as u}from\"../snappingUtils.js\";import{makeGetGroundElevation as g,convertSnappingCandidate as h}from\"./queryEngineUtils.js\";import{getSnappingCandidateElevationAligner as m}from\"./snappingCandidateElevationAlignment.js\";import{getSnappingCandidateElevationFilter as d}from\"./snappingCandidateElevationFilter.js\";import{getSymbologySnappingCandidatesFetcher as v}from\"./symbologySnappingCandidates.js\";let f=class extends t{get availability(){return 1}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,i=null!=e&&\"3d\"===e.type;if(!i||\"subtype-group\"===t.type)return m();const r=async(i,r)=>(await n(e.whenLayerView(t),r)).elevationAlignPointsInFeatures(i,r);return m(i,{elevationInfo:t.elevationInfo,alignPointsInFeatures:r})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&\"3d\"===e.type&&\"subtype-group\"!==this.layerSource.layer.type;return d(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&\"3d\"===e.type&&\"subtype-group\"!==t.type?v(this._symbologySnappingSupported,(async(i,n)=>{const o=await e.whenLayerView(t);return r(n),o.queryForSymbologySnapping({candidates:i,spatialReference:e.spatialReference},n)})):v()}get _layerView(){const{view:e}=this;if(null==e)return null;const{layer:t}=this.layerSource;return e.allLayerViews.find((e=>e.layer===t))}get _layerView3D(){const{view:e}=this;return null==e||\"2d\"===e.type?null:this._layerView}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&\"3d\"===e.type&&\"subtype-group\"!==t.type&&this.addHandles([e.elevationProvider.on(\"elevation-change\",(({context:e})=>{const{elevationInfo:i}=t;c(e,i)&&this._snappingElevationAligner.notifyElevationSourceChange()})),o((()=>t.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),s),o((()=>null!=this._layerView3D?this._layerView3D.layer?.renderer:null),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),s),a((()=>this._layerView3D?.layer),[\"edits\",\"apply-edits\",\"graphic-update\"],(()=>this._symbologySnappingFetcher.notifySymbologyChange()))])}constructor(e){super(e),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=i(g)}refresh(){}async fetchCandidates(e,t){const{layer:i}=this.layerSource,{source:n}=i;if(!n?.querySnapping)return[];const o=i.createQuery();this._layerView&&\"effectiveDisplayFilter\"in this._layerView&&(o.where=l(o.where,this._layerView.effectiveDisplayFilter?.where));const a=\"returnZ\"in i?i.returnZ:void 0,s=u({parameters:e,mode:this.view?.type??\"2d\",returnZ:a,filter:o}),p=await n.querySnapping(s,{signal:t});r(t);const y=e.coordinateHelper.spatialReference,c=await this._snappingElevationAligner.alignCandidates(p.candidates,y,t);r(t);const g=await this._symbologySnappingFetcher.fetch(c,t);r(t);const m=0===g.length?c:[...c,...g],d=this._snappingElevationFilter.filter(s,m),v=this._memoizedMakeGetGroundElevation(this.view,y);return d.map((e=>h(e,v)))}};e([p({constructOnly:!0})],f.prototype,\"layerSource\",void 0),e([p({constructOnly:!0})],f.prototype,\"view\",void 0),e([p()],f.prototype,\"_snappingElevationAligner\",null),e([p()],f.prototype,\"_snappingElevationFilter\",null),e([p()],f.prototype,\"_symbologySnappingFetcher\",null),e([p()],f.prototype,\"_layerView\",null),e([p()],f.prototype,\"_layerView3D\",null),e([p()],f.prototype,\"_symbologySnappingSupported\",null),f=e([y(\"esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource\")],f);export{f as FeatureCollectionSnappingSource};\n"],"names":["f","t","i","m","r","n","d","v","o","e","c","s","_a","a","g","l","u","_b","p","y","h"],"mappings":"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","x_google_ignoreList":[0]}