{"version":3,"file":"SceneLayerSnappingSourceWorker-rAfMH3_8.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js","../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{b as s,j as o,f as r}from\"../../../../../chunks/vec32.js\";import{c,a as n}from\"../../../../../chunks/sphere.js\";const t=1e3;function a(t,a,e){const f=c(),m=n(f);return s(m,m,t,.5),s(m,m,a,.5),f[3]=o(m,t),r(m,m,e),f}export{a as boundsFromEdge,t as maxCandidateCount};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{throwIfAborted as t}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/has.js\";import\"../../../../../core/RandomLCG.js\";import\"../../../../../core/Error.js\";import{subclass as o}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{f as s,j as n}from\"../../../../../chunks/vec32.js\";import{create as i,clone as r}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{create as c,fromPoints as d,projectPoint as a}from\"../../../../../geometry/support/lineSegment.js\";import{a as p,o as m}from\"../../../../../chunks/sphere.js\";import u from\"../../../../3d/webgl-engine/lib/Octree.js\";import{extractComponentsEdgeLocationsLayout as h}from\"../../../../3d/webgl-engine/lib/edgeRendering/edgeProcessing.js\";import{maxCandidateCount as g,boundsFromEdge as l}from\"./sceneLayerSnappingUtils.js\";let f=class{constructor(){this._idToComponent=new Map,this._components=new u((e=>e.bounds)),this._edges=new u((e=>e.bounds)),this._tmpLineSegment=c(),this._tmpP1=i(),this._tmpP2=i(),this._tmpP3=i(),this.remoteClient=null}async fetchCandidates(e,o){await Promise.resolve(),t(o),await this._ensureEdgeLocations(e,o);const s=[];return this._edges.forEachNeighbor((t=>(this._addCandidates(e,t,s),s.length<g)),e.bounds),{result:{candidates:s}}}async _ensureEdgeLocations(e,t){const o=[];if(this._components.forEachNeighbor((e=>{if(null==e.info){const{id:t,uid:s}=e;o.push({id:t,uid:s})}return!0}),e.bounds),!o.length)return;const s={components:o},n=await this.remoteClient.invoke(\"fetchAllEdgeLocations\",s,t??{});for(const i of n.components)this._setFetchEdgeLocations(i)}async add(e){const t=new j(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor((o=>(o.component===t&&e.push(o),!0)),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const t=this._idToComponent.get(e.id);if(null==t||e.uid!==t.uid)return;const o=h.createView(e.locations),s=new Array(o.count),n=i(),r=i();for(let i=0;i<o.count;i++){o.position0.getVec(i,n),o.position1.getVec(i,r);const c=l(n,r,e.origin),d=new w(t,i,c);s[i]=d}this._edges.add(s);const{objectIds:c,origin:d}=e;t.info={locations:o,objectIds:c,origin:d}}_addCandidates(e,t,o){const{info:n}=t.component,{origin:i,objectIds:r}=n,c=n.locations,d=c.position0.getVec(t.index,this._tmpP1),a=c.position1.getVec(t.index,this._tmpP2);s(d,d,i),s(a,a,i);const p=r[c.componentIndex.get(t.index)];this._addEdgeCandidate(e,p,d,a,o),b(e,p,d,o),b(e,p,a,o)}_addEdgeCandidate(e,t,o,s,i){if(!e.returnEdge)return;const c=p(e.bounds),u=d(o,s,this._tmpLineSegment),h=a(u,c,this._tmpP3);m(e.bounds,h)&&i.push({type:\"edge\",objectId:t,target:r(h),distance:n(c,h),start:r(o),end:r(s)})}};f=e([o(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")],f);const _=f;function b(e,t,o,s){if(!e.returnVertex||!m(e.bounds,o))return;const i=p(e.bounds);s.push({type:\"vertex\",objectId:t,target:r(o),distance:n(i,o)})}class j{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++j.uid}static{this.uid=0}}class w{constructor(e,t,o){this.component=e,this.index=t,this.bounds=o}}export{_ as default};\n"],"names":["t","a","e","f","c","m","n","s","o","r","u","i","g","j","h","l","d","w","p","b","_","_j"],"mappings":"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","x_google_ignoreList":[0,1]}