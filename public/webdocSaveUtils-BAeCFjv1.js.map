{"version":3,"mappings":"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","names":["O","e","T","t","r","M","o","k","P","E","a","i","U","I","x","_e","W","d","C","V","s","Z","be","D","_a","R","f","m","me","ee","G","h","L","N","$","B","F","H","K","J","q","z","Q","X","Y","w","y","te","ie","ne","se","le","pe","ce","ue","oe","re","c","ae","we","g","v","_","A","fe","l","__vitePreload","j","n","b","de","u","ye","he","ge","S","p","ve","je","Re"],"ignoreList":[0],"sources":["../../node_modules/@arcgis/core/webdoc/support/webdocSaveUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{MultiOriginJSONSupport as t}from\"../../core/MultiOriginJSONSupport.js\";import{whenOnce as o}from\"../../core/reactiveUtils.js\";import{urlToObject as r,hasSameCanonicalPortal as a}from\"../../core/urlUtils.js\";import{updateOrigins as i}from\"../../core/accessorSupport/originUtils.js\";import n from\"../../geometry/SpatialReference.js\";import{equals as s}from\"../../geometry/support/spatialReferenceUtils.js\";import{webMercatorToGeographic as l}from\"../../geometry/support/webMercatorUtils.js\";import{isServerOrServicesAGOLUrl as p}from\"../../layers/support/arcgisLayerUrl.js\";import{isLayerWithFeatureLayerSource as c,isFeatureCollectionLayer as u}from\"../../layers/support/layerUtils.js\";import m from\"../../portal/Portal.js\";import f from\"../../portal/PortalItem.js\";import{createForItemWrite as d}from\"../../portal/support/jsonContext.js\";import{removeTypeKeyword as w,addTypeKeyword as y,typeKeyword as h,hasTypeKeyword as g,toggleTypeKeyword as _}from\"../../portal/support/portalItemUtils.js\";import{project as b}from\"../../rest/geometryService/project.js\";import j from\"../../rest/support/ProjectParameters.js\";import{findSpatialReference as R,hasDeveloperBasemapLayer as v,isDeveloperBasemapLayer as S}from\"../../support/basemapUtils.js\";import{saveResources as W}from\"./resourceUtils.js\";import{beforeSave as P,evaluateWriteErrors as I,hasCharts as A}from\"./saveUtils.js\";const O=[\"NatGeo_World_Map\",\"Ocean_Basemap\",\"USA_Topo_Maps\",\"World_Imagery\",\"World_Street_Map\",\"World_Terrain_Base\",\"World_Topo_Map\",\"World_Hillshade\",\"Canvas/World_Light_Gray_Base\",\"Canvas/World_Light_Gray_Reference\",\"Canvas/World_Dark_Gray_Base\",\"Canvas/World_Dark_Gray_Reference\",\"Ocean/World_Ocean_Base\",\"Ocean/World_Ocean_Reference\",\"Reference/World_Boundaries_and_Places\",\"Reference/World_Reference_Overlay\",\"Reference/World_Transportation\"].map((e=>e.toLowerCase()));async function T(e,t,r){r??={},M(e,t),await o((()=>!t.updatingFromView)),await t.load(),await k(t),await P(t),await E(e,t);const a=t.portalItem,{json:i,jsonContext:n}=await U(t,a,e.origin);return I(n,{errorName:`${e.name}:save`},r),await x(t,a),await _e(e,t,a,i,n),await Promise.all([t.updateItemThumbnail(),W(t.resourceReferences,n)]),a}async function U(e,t,o){const r=d(t,o,!0),a=e.write({},r);return await Promise.all(r.resources.pendingOperations),{json:a,jsonContext:r}}async function C(e,t,r,a){a??={};const i=V(e,r);await o((()=>!t.updatingFromView)),await t.load(),await k(t),await P(t),await E(e,t);const{json:n,jsonContext:s}=await U(t,i,e.origin);I(s,{errorName:`${e.name}:save`},a),await Z(t,i);const l=t.getThumbnailState();return await be(e,t,i,n,s,a)&&(t.resourceReferences.portalItem=i),t.restoreThumbnailFromState(l),await Promise.all([t.updateItemThumbnail(),W(t.resourceReferences,s)]),i}function M(t,o){if(!o.portalItem)throw new e(`${t.name}:portal-item-not-set`,\"Portal item to save to has not been set on the WebMap\");D(t,o.portalItem)}function D(t,o){if(o.type!==t.itemType)throw new e(`${t.name}:portal-item-wrong-type`,`Portal item needs to have type \"${t.itemType}\"`)}async function E(t,r){if(\"linkchart\"===t.name)return;if(!r.basemap?.baseLayers.length)throw new e(`${t.name}:save`,\"Map does not have a valid basemap with a base layer.\");let a=null;if(await o((()=>{const e=R(r.initialViewProperties,r.basemap);return a=e.spatialReference,!e.updating})),!s(a,r.initialViewProperties.spatialReference))throw new e(`${t.name}:save`,\"The spatial reference of the basemap is not compatible with the one from the map.\",{expected:r.initialViewProperties.spatialReference,actual:a})}function V(e,t){let o=f.from(t);return o.id&&(o=o.clone(),o.id=null),o.type||(o.type=e.itemType),o.portal||(o.portal=m.getDefault()),D(e,o),o}function k(e){const t=[];return e.basemap&&t.push(e.basemap.load()),e.ground&&t.push(e.ground.load()),Promise.allSettled(t).then((()=>{}))}async function x(e,t){t.extent=await me(e.portalItem,e.initialViewProperties.viewpoint.targetGeometry),await ee(e,t)}const G=h.JSAPI,L=\"CollectorDisabled\",N=\"Collector\",$=\"Data Editing\",B=\"OfflineDisabled\",F=\"Offline\",H=\"Workforce Project\",K=\"Workforce Worker\",J=\"Workforce Dispatcher\",q=\"Offline Map Areas\",z=\"FieldMapsDisabled\",Q=h.DEVELOPER_BASEMAP,X=\"UtilityNetwork\",Y=\"IPS\";async function Z(e,t){w(t,L),w(t,z),w(t,h.METADATA),w(t,B),w(t,q),w(t,J),w(t,H),w(t,K),await x(e,t)}async function ee(e,t){y(t,G),await te(e),ie(e,t),ne(e,t),se(e,t),le(e,t),pe(e,t),ce(e,t),ue(e,t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter(((e,t,o)=>o.indexOf(e)===t)))}function te(e){const t=oe(e).map((e=>e.load())).toArray();return Promise.allSettled(t).then((()=>{}))}function oe(e){return e.allLayers.concat(e.allTables)}function re(e){return oe(e).some((e=>e.loaded&&c(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&(\"subtype-group\"!==e.type||e.sublayers.some((e=>e.editingEnabled)))))}function ae(e){return oe(e).filter((e=>\"group\"!==e.type)).every((t=>t.loaded&&we(e,t)))}function ie(e,t){g(t,L)||g(t,H)||g(t,K)||g(t,J)||!re(e)?w(t,N):y(t,N)}function ne(e,t){re(e)?y(t,$):w(t,$)}function se(e,t){!g(t,B)&&ae(e)?y(t,F):w(t,F)}function le(e,t){v(e.basemap)?y(t,Q):w(t,Q)}function pe(e,t){e.utilityNetworks?.length?y(t,X):w(t,X)}function ce(e,t){e.ipsInfo?y(t,Y):w(t,Y)}function ue(e,t){_(t,h.CHARTS,A(e))}async function me(e,t){const o=t.clone().normalize();let r;if(o.length>1)for(const a of o)r?a.width>r.width&&(r=a):r=a;else r=o[0];return fe(e,r)}async function fe(e,t){const o=t.spatialReference;if(o.isWGS84)return t.clone();if(o.isWebMercator)return l(t);const{getGeometryServiceURL:r}=await import(\"../../portal/support/geometryServiceUtils.js\"),a=await r(e),i=new j({geometries:[t],outSpatialReference:n.WGS84});return(await b(a,i))[0]}function de(e){return u(e)||\"map-notes\"===e.type||\"route\"===e.type}function we(e,t){return c(t)&&t.capabilities.operations.supportsSync||de(t)&&!t.portalItem||ye(t)&&!he(t)&&t.spatialReference.equals(e.initialViewProperties.spatialReference)}function ye(e){return(\"tile\"===e.type||\"vector-tile\"===e.type)&&(e.capabilities.operations.supportsExportTiles||ge(e)||S(e))}function he(e){return\"vector-tile\"===e.type&&Object.keys(e.sourceNameToSource).length>1}function ge(e){return\"tile\"===e.type&&(p(e.url)&&O.some((t=>e.url?.toLowerCase().includes(\"/\"+t+\"/\"))))}async function _e(e,t,o,r,a){await o.update({data:r}),ve(e,t,o,r,a)}async function be(t,o,r,a,i,n){const s=o.portalItem,l={item:s,authenticated:!(!s?.id||!s.portal.user)},p=r.portal;await p.signIn();const{copyAllowed:c,itemReloaded:u}=await je(l,p);if(l.authenticated||=u,!c)throw new e(`${t.name}:save-as-copy-not-allowed`,\"Owner of this map does not allow others to save a copy\");const m=await Re(r,l,a,n);return o.portalItem=r,ve(t,o,r,a,i),m}async function je(e,t){const{item:o,authenticated:r}=e;return o?.id&&o.typeKeywords?.includes(\"useOnly\")?o.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await o.reload(),{copyAllowed:\"admin\"===o.itemControl||\"update\"===o.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function Re(e,t,o,r){const i=e.portal,{item:n}=t,{folder:s,copyAllResources:l}=r;let p=!1;if(l&&n?.id&&a(n.portal.url,i.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:e}=await n.fetchResources();p=!!e}if(p){const t=await n.copy({copyResources:\"all\",folder:s});e.id=t.id,e.portal=t.portal;const r=e.toJSON();await e.load(),e.read(r),await e.update({data:o})}else await i.user.addItem({item:e,folder:s,data:o});return p}function ve(e,o,a,n,s){t.prototype.read.call(o,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{origin:e.origin,ignoreDefaults:!0,url:a.itemUrl?r(a.itemUrl):void 0}),i(s),o.resourceInfo=n}export{U as createJSON,Re as initializeNewItem,je as isCopyAllowed,T as save,C as saveAs};\n"],"file":"public/webdocSaveUtils-BAeCFjv1.js"}